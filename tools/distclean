#!/bin/sh
# clean-up program for the open source edition of ProofPower
# removes all files other than sources from the src directory.
#
# clean: this file is part of the ProofPower system
# 
# Copyright (c) 2002 Lemma 1 Ltd.
#
# See the file LICENSE for your rights to use and change this file.
#
# Contact: Rob Arthan < rda@lemma-one.com >
#
# $Id: distclean.sh,v 1.10 2007/01/28 10:07:07 rda Exp rda $
#
give_up(){
	echo configure: $*
	exit 1
}
#
# Check we have a src directory
#
CWD=`pwd`
if	[ ! -d src ]
then	give_up "the directory $CWD/src does not exist"
else	cd src
fi
#
# Work round the subdirectories deleting everything that is not
# in the packing list for the makefile.
#
for d in pptex dev xpp hol zed
do	mkf=$CWD/src/$d/$d.mkf
	if	[ -f $mkf ]
	then	cd $CWD/src/$d
		#
		# Calculate files to be retained
		#
		if	make -f $mkf distpackinglist >/dev/null 2>&1
		then	TOKEEP="RCS `make -f $mkf distpackinglist`"
		else	TOKEEP="RCS `make -f $mkf packinglist`"
		fi
		#
		# Calculate items to delete (may include directories, e.g.,
		# .dSYM directories generated by the C compiler on Mac OS X.
		#
		TODELETE="`{ { echo $TOKEEP | tr ' ' '\n'; }; ls; } | sort | uniq -u`"
		#
		# Delete them:
		#
		rm -rf $TODELETE
	fi
done

