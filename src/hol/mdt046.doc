% mdt046.doc  %Z% $Date$ $Id$
=TEX
\documentstyle[hol,11pt,TQ]{article}
\ftlinepenalty=9999
\makeindex
\TPPproject{FST PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Module Tests for the Constant Specification Tools}  %% Mandatory field
\def\TPPheadtitle{Module Tests for the \cr Constant Specification Tools}
\TPPref{DS/FMU/IED/MDT046}  %% Mandatory field
\def\SCCSversion{$Revision$ %
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$ %
}}
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{ML Literate Script}
\TPPkeywords{}
\TPPauthor{K.Blackburn & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.D.Arthan & Project Manager}
\TPPabstract{A set of module tests are given for the 
the constant specification tools.}
\TPPdistribution{\parbox[t]{4.0in}{%
	    Library
}}
\begin{document}
\makeTPPfrontpage
\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}
\pagebreak
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History} 
\begin{description}
\item [Issue 1.1]
First draft.
\end{description}
\subsection{Changes Forecast}
None.
\section{GENERAL}
\subsection{Scope}
This document contains the module testing of the contant specification tools.
The design is in \cite{DS/FMU/IED/DTD046}
and it is
implemented in \cite{DS/FMU/IED/IMP046}.

\subsection{Introduction}
\subsubsection{Purpose and Background}
This document contains the module testing of the material given a design in \cite{DS/FMU/IED/DTD046},
following the test policy given in that document and the general policy given in \cite{DS/FMU/IED/PLN008}.

\subsubsection{Dependencies}
This document is derived from the detailed design in \cite{DS/FMU/IED/DTD046},
and is further influenced by the implementation, in  \cite{DS/FMU/IED/IMP046}.
\subsubsection{Deficiencies}
None known.
\section{TEST CASES}
We test each function of the signature of \cite{DS/FMU/IED/DTD046}
in turn, where possible in the same order as in the design document, testing both successful, and all error, cases,
except for 6037 and 6071, concerning the writability of theories.
These are untested here because they were extensively tested for the primitive theory functions, elsewhere.
\section{PROLOGUE}
Initialise the test package:
=SML
usefile "dtd013.sml";
usefile "imp013.sml";
init_mt_results();
open_theory "pair";
delete_theory "mdttest_046b" handle _ => ();
delete_theory "mdttest_046" handle _ => ();
new_theory "mdttest_046";
new_theory "mdttest_046b";
=TEX
»
OutOfContext : 'a
…
T
À
=SML
open_theory "mdttest_046";
=TEX
=TEX
\section{SETTING THE PROOF CONTEXT}
To make the tests independent of some outside changes, we give a local 
proof context:
=SML
val ‚Ñ_rewrite_thm1· = (
	push_goal([],ªÉ t :'aé (Ñ x é x = t) Ä (Ñ x é t = x)º);
	a(REPEAT strip_tac);
	a(Ñ_tac ªt:'aº THEN rewrite_tac[]);
	a(Ñ_tac ªt:'aº THEN rewrite_tac[]);
	pop_thm());

fun ‚a_get_epc_cs_Ñ_rule· (epc : EPROOF_CONTEXT) (tm:TERM) : THM = 
	tac_proof(([],tm),rewrite_tac[Ñ_rewrite_thm1]);

val epc = get_proof_context ();

push_proof_context (set_epc_cs_Ñ_rule a_get_epc_cs_Ñ_rule epc);
=TEX
\section{THE TESTS}
\subsection{$HOL\_axiomatic\_recogniser$}
»
c5 : BOOL ã BOOL,
c6 : BOOL ã BOOL
…
(É x é c5 x = å x)
Ä
(É y é c6 y = y)
À
»
c7 : 'a â 'b,
c8 : 'b â 'a
…
T
À
»
c9 : 'a â 'b
…
F
À

=TEX
=SML
store_mt_results mt_run [
	("HOL_axiomatic_recogniser 1",
	dest_thm o get_defn "-",
	"c5",
	([],ªConstSpec (ç(c5',c6')é (É x é c5' x = å x)
		Ä
		(É y é c6' y = y)) (c5,c6)º)),
	("HOL_axiomatic_recogniser 2",
	dest_thm o get_defn "-",
	"c6",
	([],ªConstSpec (ç(c5',c6')é (É x é c5' x = å x)
		Ä
		(É y é c6' y = y)) (c5,c6)º)),
	("HOL_axiomatic_recogniser 3",
	dest_thm o get_defn "-",
	"c7",
	([],ªTº)),
	("HOL_axiomatic_recogniser 4",
	dest_thm o get_defn "-",
	"c8",
	([],ªTº))
	];
=TEX
The following will perhaps change (and also cause some output to the screen):
=SML
store_mt_results mt_run_fail [
	("HOL_axiomatic_recogniser 46000",
	HOL_axiomatic_recogniser,
	("(",")",[],"[]"),
	gen_fail_msg "HOL_axiomatic_recogniser" 46000 [])
	];
=TEX
\subsection{$const\_spec$}
=SML
const_spec (["c1","c2","c3"],[ªc1:BOOLº,ª(c2:BOOL,c3:BOOL)º],
	ªc1 Ä c2 Ä c3º);
const_spec (["c4"],[ªc4:BOOLº],ªc4 Ç Tº);
=TEX
=SML
store_mt_results mt_run [
	("const_spec 1",
	dest_thm o get_defn "-",
	"c1",
	([],ªConstSpec (ç(c1',c2',c3')éc1' Ä c2' Ä c3')(c1,c2,c3)º)),
	("const_spec 2",
	dest_thm o get_defn "-",
	"c2",
	([],ªConstSpec (ç(c1',c2',c3')éc1' Ä c2' Ä c3')(c1,c2,c3)º)),
	("const_spec 3",
	dest_thm o get_defn "-",
	"c2",
	([],ªConstSpec (ç(c1',c2',c3')éc1' Ä c2' Ä c3')(c1,c2,c3)º)),
	("const_spec 4",
	dest_thm o get_defn "-",
	"c4",
	([],ªc4 Ç Tº))
	];
=TEX
=SML
store_mt_results mt_run_fail [
	("const_spec 3031",
	const_spec,
	(["ec1"],[ªxº],ªyº),
	gen_fail_msg "const_spec" 3031 ["ªyº"]),
	("const_spec 6031",
	const_spec,
	([],[ªxº],ªTº),
	gen_fail_msg "const_spec" 6031 []),
	("const_spec 6044",
	const_spec,
	(["test"],[],ªTº),
	gen_fail_msg "const_spec" 6044 []),
	("const_spec 6049",
	const_spec,
	(["test"],[mk_var("T",BOOL)],ªTº),
	gen_fail_msg "const_spec" 6049 ["T"]),
	("const_spec 6051",
	const_spec,
	(["c1"],[ªv1º],ªTº),
	gen_fail_msg "const_spec" 6051 ["c1","mdttest_046"]),
	("const_spec 6056",
	const_spec,
	(["ec1"],[ªec1º],ªvar:BOOLº),
	gen_fail_msg "const_spec" 6056 ["Ö Ñ ec1é ConstSpec (ç ec1'é var) ec1","var"]),
	("const_spec 6061",
	const_spec,
	(["ec1"],[ªec1º],ªÉ x : 'b é x = xº),
	gen_fail_msg "const_spec" 6061 ["Ö Ñ ec1é É xé x = x", "'b"]),
	("const_spec 6063",
	const_spec,
	(["OutOfContext"],[ªOutOfContextº],ªTº),
	gen_fail_msg "const_spec" 6063 ["OutOfContext"]),
	("const_spec 6081",
	const_spec,
	(["ec1","ec2"],[ªec1,ec2º],ªTº),
	gen_fail_msg "const_spec" 6081 ["ªec1º","ªec2º"]),
	("const_spec 46003",
	const_spec,
	(["ec1","ec2"],[ªec1, ec1º],ªTº),
	gen_fail_msg "const_spec" 46003 ["ec1"]),
	("const_spec 46004",
	const_spec,
	(["ec1","ec2"],[ª(ec1, T)º],ªTº),
	gen_fail_msg "const_spec" 46004 ["ª(ec1, T)º"])	
	];
=TEX
\subsection{$get\_specification$ Part I}
=SML
store_mt_results mt_run [
	("get_specification 1",
	dest_thm o get_specification,
	"c1",
	([ªConsistent (ç(c1',c2',c3')éc1' Ä c2' Ä c3')º],
		ªc1 Ä c2 Ä c3º)),
	("get_specification 2",
	dest_thm o get_specification,
	"c2",
	([ªConsistent (ç(c1',c2',c3')éc1' Ä c2' Ä c3')º],
		ªc1 Ä c2 Ä c3º)),
	("get_specification 3",
	dest_thm o get_specification,
	"c3",
	([ªConsistent (ç(c1',c2',c3')éc1' Ä c2' Ä c3')º],
		ªc1 Ä c2 Ä c3º)),
	("get_specification 4",
	dest_thm o get_specification,
	"c4",
	([],ªc4 Ç Tº))
	];

=TEX
=SML
store_mt_results mt_run_fail [
	("get_specification 46005",
	get_specification,
	"rubbish",
	gen_fail_msg "get_specification" 46005 ["rubbish"]),
	("get_specification 46006",
	get_specification,
	"ä",
	gen_fail_msg "get_specification" 46006 ["ä"])
	];
=TEX
\subsection{$push\_consistency\_goal$}
=SML
push_consistency_goal "c2";
store_mt_results mt_run [
	("push_consistency_goal",
	top_goal,
	(),
	([],ªÑ (c1', c2', c3') é c1' Ä c2' Ä c3'º))
	];
store_mt_results mt_run_fail [
	("push_consistency_goal 46005",
	push_consistency_goal,
	"rubbish",
	gen_fail_msg "push_consistency_goal" 46005 ["rubbish"]),
	("push_consistency_goal 46006",
	push_consistency_goal,
	"ä",
	gen_fail_msg "push_consistency_goal" 46006 ["ä"]),
	("push_consistency_goal 46007",
	push_consistency_goal,
	"c4",
	gen_fail_msg "push_consistency_goal" 46007 ["c4"])
	];
=TEX
\subsection{$save\_consistency\_thm$}
=SML
a(Ñ_tac ª(T,T,T)º);
a(rewrite_tac[]);
val thm = pop_thm();
save_consistency_thm "c3" thm;
store_mt_results mt_run [
	("save_consistency_thm",
	dest_thm o get_thm "-",
	"c2_consistent",
	([],ªConsistent (ç(c1',c2',c3')éc1' Ä c2' Ä c3')º))
	];
=TEX
=SML
store_mt_results mt_run_fail [
	("save_consistency_thm 46005",
	save_consistency_thm "rubbish",
	thm,
	gen_fail_msg "save_consistency_thm" 46005 ["rubbish"]),
	("save_consistency_thm 46006",
	save_consistency_thm "ä",
	thm,
	gen_fail_msg "save_consistency_thm" 46006 ["ä"]),
	("save_consistency_thm 46008",
	save_consistency_thm "c2",
	t_thm,
	gen_fail_msg "save_consistency_thm" 46008 ["ªTº"]),
	("save_consistency_thm 46011",
	save_consistency_thm "c5",
	thm,
	gen_fail_msg "save_consistency_thm" 46011 
		["Ö Consistent (ç (c1', c2', c3')é c1' Ä c2' Ä c3')",
		"c5"]),
	("save_consistency_thm 46012",
	save_consistency_thm "c4",
	thm,
	gen_fail_msg "save_consistency_thm" 46012 ["ªc4 Ç Tº"])
	];
=TEX
\subsection{$get\_specification$ Part II}
Now we have a consistency property saved we can use it:
=SML
store_mt_results mt_run [
	("get_specification 1",
	dest_thm o get_specification,
	"c1",
	([], ªc1 Ä c2 Ä c3º)),
	("get_specification 2",
	dest_thm o get_specification,
	"c2",
	([], ªc1 Ä c2 Ä c3º))
	];
=TEX

=IGN
\subsection{}
store_mt_results mt_run [
	("",
	,
	,
	)
	];
store_mt_results mt_run_fail [
	("",
	,
	,
	gen_fail_msg ""  [])
	];
=TEX
\subsection{End of Tests}
=SML
diag_string(summarize_mt_results());
=TEX
\end{document}
