%  $Id$ %Z%
=TEX
\documentstyle[hol,11pt,TQ]{article}
\ftlinepenalty=9999
\makeindex
\TPPproject{IED 1563}  %% Mandatory field
\TPPtitle{Implementation for the Theory of Sets}  %% Mandatory field
\def\TPPheadtitle{Implementation for the Theory of Sets}
\TPPref{DS/FMU/IED/IMP044}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$ %
}}  %% Mandatory field
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{SML Literate Script}
\TPPkeywords{}
\TPPauthor{K.~Blackburn & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.D.Arthan & FST Team Leader}
\TPPabstract{This document creates the theory ``sets''.}
\TPPdistribution{\parbox[t]{4.0in}{%
	    Project Library
}}
%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}
\begin{document}
\makeTPPfrontpage
\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}
\pagebreak
\section{Document Control}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History}
\begin{description}
\item [Issue 1.2]
First version.
\item [Issue 1.3]
Changed to match \cite{DS/FMU/IED/HLD011}.
\item [Issue 1.4]
Simplified requirement on $IsSetRep$.
\end{description}
\subsection{Changes Forecast}
Further theorems, and some function tools will be later provided.
\section{GENERAL}
\subsection{Scope}
This document contains an implementation of the theory of sets.
This is called for in \cite{DS/FMU/IED/HLD011}.
The design is in \cite{DS/FMU/IED/DTD044}.
\subsection{Introduction}
\subsubsection{Purpose and Background}
This document contains an implementation of the 
theory of sets.
\subsubsection{Dependencies}
This document takes its signature from \cite{DS/FMU/IED/DTD044},
and also requires the theory ``char'' defined in
\cite{DS/FMU/IED/DTD040}.
\subsubsection{Deficiencies}
None known.
\subsubsection{Possible Enhancements}
None known.
\section{THE THEORY ``sets''}
=SML
structure ‚SetsTheory· : SetsTheory = struct
val lsubgoal_package_quiet = set_flag("subgoal_package_quiet",true);
val _ = open_theory "char";
val _ = new_theory "sets";
=TEX
=SML
val ‚is_set_rep_thm· = new_specification(["IsSetRep"],1, (
push_goal([],ªÑ IsSetRep:('a ã BOOL) ã BOOL é
	IsSetRep = ç x: 'a ã BOOLé Tº);
a(simple_Ñ_tac ªç x:'a ã BOOLé Tº THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚set_def· = new_type_defn("SET","SET",["'a"],(
push_goal([],ªÑ x: 'a ã BOOL é IsSetRep xº);
a(rewrite_tac[is_set_rep_thm]);
pop_thm()));
=TEX
=SML
val _ = declare_binder "SetComp";
val _ = declare_infix (230,"ù");
val ‚set_comp_def· = new_specification(["SetComp","ù"],2,(
push_goal([],ªÑ ($SetComp:('a ã BOOL) ã 'a SET)
	($ù : 'a ã 'a SET ã BOOL) é
	É (x : 'a) (p:'a ã BOOL) (S1: 'a SET) (S2 : 'a SET)é
	(x ù (SetComp v ép v) Ç p x) Ä
	(S1 = S2 Ç (É x:'aé x ù S1 Ç x ù S2))º);
a (strip_asm_tac (rewrite_rule [is_set_rep_thm]
	(simple_ä_match_mp_rule type_lemmas_thm set_def)));
a(MAP_EVERY simple_Ñ_tac
	[ªç x é abs xº,
	ªç x S é (rep S) xº]);
a(asm_rewrite_tac[]);
a(rewrite_tac[all_É_intro(eq_sym_rule(all_simple_É_elim ext_thm))]);
a(REPEAT simple_É_tac THEN Ç_tac);
(* *** Goal "1" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(POP_ASM_T (ante_tac o ap_fun_rule ªabsº));
a(asm_rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚insert_def· = new_specification(["Empty","Insert"],2,(
push_goal([],ªÑ (Empty : 'a SET) (Insert: 'a ã 'a SET ã 'a SET)é
	É (x : 'a) (y : 'a) (S: 'a SET) é
	å x ù Empty Ä
	(x ù Insert y S Ç x = y Å x ù S)º);
a(MAP_EVERY simple_Ñ_tac
	[ª{v:'a | (ç x é F) v}º, 
	ªç y S é {x | x = y Å x ù S}º]);
a(rewrite_tac[set_comp_def]);
a(REPEAT simple_É_tac);
a(LEMMA_T ª{x:'a | x = y Å x ù S} = {x:'a | (ç x é x = y Å x ù S) x}º
	(fn x => pure_rewrite_tac[x]));
(* *** Goal "1" *** *)
a(rewrite_tac[]);
(* *** Goal "2" *** *)
a(rewrite_tac[set_comp_def]);
pop_thm()));
=TEX
=SML
val ‚set_clauses· = save_thm("set_clauses",(
push_goal([],ªÉ (x : 'a) (y : 'a) (p:'a ã BOOL) (q : BOOL) (S1: 'a SET) (S2 : 'a SET)é
	å x ù {} Ä
	(x ù {v | q} Ç q) Ä
	(x ù {v | p v} Ç p x) Ä
	(x ù {v | v = y} Ç (x = y)) Ä
	(x ù {y} Ç (x = y)) Ä
	(S1 = S2 Ç (É x:'aé x ù S1 Ç x ù S2))º);
a(rewrite_tac[set_comp_def, insert_def]);
a(REPEAT simple_É_tac);
a(LEMMA_T ª{v|q} = {v|(çs é q) v}º (fn x => pure_rewrite_tac[x]));
(* *** Goal "1" *** *)
a(rewrite_tac[]);
(* *** Goal "2" *** *)
a(rewrite_tac[set_comp_def]);
a(LEMMA_T ª{v|v = y} = {v | (ç x é x = y) v}º (fn x => pure_rewrite_tac[x]));
(* *** Goal "2.1" *** *)
a(rewrite_tac[]);
(* *** Goal "2.2" *** *)
a(rewrite_tac[set_comp_def]);
pop_thm()));
=TEX
=SML
local
	val aux_thm = tac_proof(([],ª
		É x : 'a é
		É p : 'a ã BOOL é
		x ù {v | p v} Ç p xº),
		rewrite_tac[set_clauses]);
	val tva = ª:'aº;
in
val ‚simple_ù_conv· : CONV = (fn tm:TERM =>
let	val (x,S) = dest_bin_op "simple_ù_conv" 44001 "ù" tm;
	val (v,pv) = dest_set_comp S;
	val sideeffect = (if is_var v
		then ()
		else term_fail "simple_ù_conv" 44001 [tm]);
	val s1 = inst_type_rule [(type_of x, tva)] aux_thm;
	val s2 = list_simple_É_elim[x, 
		mk_simple_ç(v,pv)] s1;
	val s3 =  conv_rule (APP_C
		((RAND_C o RAND_C o BINDER_C) simple_%beta%_conv,
		simple_%beta%_conv))s2;
	val s4 = eq_trans_rule (%alpha%_conv 
		(fst(dest_Ç(concl s3))) tm)
		s3
in
	s4
end);
end;
=TEX
\subsection{Derived Definitions}
=SML
val _ = declare_infix (260,"°");
val ‚°_def· = new_specification(["°"],1,(
push_goal([],ªÑ $°: 'a SET ã 'a SET ã 'a SET é
	É (x:'a) (S1 : 'a SET) (S2 : 'a SET) é 
	x ù S1 ° S2 Ç x ù S1 Å x ù S2º);
a(simple_Ñ_tac ªç S1 S2 é {x : 'a | x ù S1 Å x ù S2}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val _ = declare_infix (270,"†");
val ‚†_def· = new_specification(["†"],1,(
push_goal([],ªÑ $†: 'a SET ã 'a SET ã 'a SET é
	É (x:'a) (S1 : 'a SET) (S2 : 'a SET) é 
	x ù S1 † S2 Ç x ù S1 Ä x ù S2º);
a(simple_Ñ_tac ªç S1 S2 é {x : 'a | x ù S1 Ä x ù S2}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val _ = declare_infix (250,"ƒ");
val ‚ƒ_def· = new_specification(["ƒ"],1,(
push_goal([],ªÑ $ƒ: 'a SET ã 'a SET ã 'a SET é
	É (x:'a) (S1 : 'a SET) (S2 : 'a SET) é 
	x ù S1 ƒ S2 Ç x ù S1 Ä å x ù S2º);
a(simple_Ñ_tac ªç S1 S2 é {x : 'a | x ù S1 Ä å x ù S2}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val _ = declare_infix (230,"•");
val ‚•_def· = new_specification(["•"],1,(
push_goal([],ªÑ $• : 'a SET ã 'a SET ã BOOL é
	É S1 S2 : 'a SET é 
	S1 • S2 Ç É x é x ù S1 ä x ù S2º);
a(simple_Ñ_tac ªç S1 S2 é É x é x ù S1 ä x ù S2º
	THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val _ = declare_infix (230,"¶");
val ‚¶_def· = new_specification(["¶"],1,(
push_goal([],ªÑ $¶ : 'a SET ã 'a SET ã BOOL é
	É S1 S2 : 'a SET é 
	S1 ¶ S2 Ç (S1 • S2 Ä (Ñ x é å x ù S1 Ä x ù S2))º);
a(simple_Ñ_tac ªç S1 S2 é (S1 • S2 Ä (Ñ x é å x ù S1 Ä x ù S2))º
	THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚£_def· = new_specification(["£"],1,(
push_goal([],ªÑ £ : ('a SET) SET ã 'a SET é 
	É (x: 'a) (S: ('a SET) SET) é 
	x ù £ S Ç Ñ s é x ù s Ä s ù Sº);
a(simple_Ñ_tac ªç S é {x | Ñ s é x ù s Ä s ù S}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚¢_def· = new_specification(["¢"],1,(
push_goal([],ªÑ ¢ : ('a SET) SET ã 'a SET é 
	É (x: 'a) (S: ('a SET) SET) é 
	(x ù ¢ S) Ç É s é s ù S ä x ù sº);
a(simple_Ñ_tac ªç S é {x | É s é s ù S ä x ù s}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚ë_def· = new_specification(["ë"],1,(
push_goal([],ªÑ ë:'a SET ã ('a SET) SET é
	É (x : 'a SET) (S: 'a SET) é 
	x ù ë S Ç x • Sº);
a(simple_Ñ_tac ªç S é {x | x • S}º
	THEN rewrite_tac[]);
a(conv_tac(ONCE_MAP_C simple_ù_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val ‚§_clauses· = save_thm("§_clauses",(
push_goal([], ªÉ (x : 'a) (S:'a SET) é
	{x | F} = {} Ä
	å x ù {} Ä
	{} ° S = S Ä
	S ° {} = S Ä
	{} † S = {} Ä
	S † {} = {} Ä
	S ƒ {} = S Ä
	{} ƒ S = {} Ä
	{} • S Ä
	(S • {} Ç S = {}) Ä
	({} ¶ S Ç å S = {}) Ä
	å S ¶ {} Ä
	å x ù £ {} Ä
	x ù ¢ {} Ä
	{} ù ë S Ä
	(ë {} = {{}})º);
a(REPEAT simple_É_tac THEN rewrite_tac[set_clauses,
	°_def, †_def, ƒ_def, •_def, ¶_def, £_def, ¢_def, ë_def]);
a(conv_tac(MAP_C simple_å_in_conv) THEN rewrite_tac[]);
pop_thm()));
=TEX
\subsection{End of Theory ``sets''}
=SML
val lsubgoal_package_quiet = set_flag("subgoal_package_quiet",
	lsubgoal_package_quiet);
end; (* of structure SetsTheory *)
open SetsTheory;
=TEX
=TEX
\newpage
\twocolumn[\section{INDEX}]
\small
\printindex
\end{document}
