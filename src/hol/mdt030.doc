=TEX
\documentstyle[hol,11pt,TQ]{article}
\ftlinepenalty=9999
\makeindex
\TPPproject{IED 1563}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Module Tests for the Subgoal Package}  %% Mandatory field
\def\TPPheadtitle{Module Tests for the Subgoal Package}
\TPPref{DS/FMU/IED/MDT030}  %% Mandatory field
\def\SCCSversion{$Revision$ %
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$ %
}}
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{ML Literate Script}
\TPPkeywords{}
\TPPauthor{K.Blackburn & WIN01}  %% Mandatory field
%\TPPauthors{K.Blackburn & WIN01\\D.J.~King & WIN01}
\TPPauthorisation{R.D.Arthan & Project Manager}
\TPPabstract{A set of module tests are given for the 
the subgoal package.}
\TPPdistribution{\parbox[t]{4.0in}{%
	    Library
}}
\begin{document}
\makeTPPfrontpage
\vfill
\begin{centering}
\bf Copyright \copyright\ : International Computers Ltd \number\year
\end{centering}
\pagebreak
\section{Document Control}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History} 
\begin{description}
\item [Issue 1.1]
First draft version, works for \cite{DS/FMU/IED/IMP030} version 1.2.
\item [Issue 1.2]
Fixed a \LaTeX fault and a spelling.
\item [Issue 1.3]
Added renaming check.
\item [Issue 1.4]
Corrected message 30051.
\item [Issue 1.5]
Renamings of functions containing the name atom $simple$,
and renaming of $aconv$.
\item [Issue 1.6]
Changes to match changes in issue 1.11 of \cite{DS/FMU/IED/DTD030},
and various changes elsewhere in system.
\item [Issue 1.7,1.8]
Reacting to issue 1.12 of \cite{DS/FMU/IED/DTD030}.
\item [Issue 1.9]
Reacting to issue 1.14 of \cite{DS/FMU/IED/IMP030}.
\end{description}
\subsection{Changes Forecast}
\section{GENERAL}
\subsection{Scope}
This document contains the module testing of the Subgoal Package, required by \cite{DS/FMU/IED/DTD030}.
The design is in \cite{DS/FMU/IED/DTD030}
and it is
implemented in \cite{DS/FMU/IED/IMP030}.

\subsection{Introduction}
\subsubsection{Purpose and Background}
This document contains the module testing of the material given a design in \cite{DS/FMU/IED/DTD030},
following the test policy given in that document and the general policy given in \cite{DS/FMU/IED/PLN008}.

Much of the testing uses material from \cite{DS/FMU/IED/DTD013},
though this is incapable of testing that the information outputs of the subgoal package are correct.
In addition, it sometimes only tests that the results are as expected by subsequent testing of the subgoal package state,
rather than the immediate outputs of the function tested.

\subsubsection{Dependencies}
This document is derived from the detailed design in \cite{DS/FMU/IED/DTD030},
and is further influenced by the implementation, in  \cite{DS/FMU/IED/IMP030}.
\subsubsection{Deficiencies}
The coverage of the tests, as called for by the test specification, may currently be incomplete.
Not tested messages 30055, 30056.
\section{INITIALISATION}
Get a new theory to work in:
=SML
val start_theory = get_current_theory_name();
new_theory "test_mdt030";
=TEX
Initialise the test package:
=SML
usefile "dtd013.sml";
usefile "imp013.sml";
init_mt_results();
=TEX
\section{VALUE BINDINGS}
=SML
val goal0 : GOAL = ([],ªTº);
val goal1 : GOAL = ([],ªx Ä (É y é y = 0)º);
val goal2 : GOAL = ([ªp Ä qº,ªr Ä (É s é s)º],ªp Ä s Ä (É q é q = 0)º);
val sg1_goal2 : GOAL = ([ªp Ä qº,ªr Ä (É s é s)º],ªp:BOOLº);
val sg2_goal2 : GOAL = ([ªp Ä qº,ªr Ä (É s é s)º],ªs Ä (É q é q = 0)º);
val goal3 = ([ªp Ä qº,ªr Ä (É s é s)º],ªå Tº);
val sg_goal3 = ([ªp Ä qº,ªr Ä (É s é s)º],ªFº);
val goal4 = ([ªp Ä qº,ªr Ä (É s é s)º],ªT Ä pº);
val sg2_goal4 = ([ªp Ä qº,ªr Ä (É s é s)º],ªp:BOOLº);
val sg1_goal4 = ([ªp Ä qº,ªr Ä (É s é s)º],ªTº);
val goal5 = ([ªp Ä qº,ªr Ä (É s é s)º],ªp Ä p Ä qº);
val sg1_goal5 = ([ªp Ä qº,ªr Ä (É s é s)º],ªp:BOOLº);
val sg3_goal5 = ([ªp Ä qº,ªr Ä (É s é s)º],ªq:BOOLº);
val goal6 = ([ªp : BOOLº],ªp Ä qº);
val tf_goal6 = ªÉ p q é p ä (icl'TS (p Ä q))º;
val stf_goal6 = ªÉ p q é p ä (p Ä q)º;
val tf_goal6_sg1 = ªÉ p é p ä (icl'TS p)º;
val tf_goal6_sg2 = ªÉ p q é p ä (icl'TS q)º;
val stf_goal6_sg1 = ªÉ p é p ä pº;
val stf_goal6_sg2 = ªÉ p q é p ä qº;
val goal7 = ([ª(a : '1) = aº],ª((a : BOOL) = a) Ä Tº);
val gst1 = asm_rule (mk_ä(ª(a : '1) = aº,ªicl'TS(((a : BOOL) = a) Ä T)º));
val goal8 = ([ª(a : '1) = aº],ªÑ b : BOOL é b = bº);
=TEX
The following function repeatedly applies a function to void,
until failure.
$repeat$ $drop\_main\_goal$ empties the main goal stack.
=SML
repeat drop_main_goal;
=TEX
\section{THE TESTS}
\subsection{push\_goal}
We test the correct operation by checking that the 
top main goal, top current goal, and goal labelled ``'' are
the goal pushed.
We cannot test message 30001, except by examination of output.
=SML
push_goal goal1;
store_mt_results mt_run [
	("push_goal 1 a",
	top_main_goal,
	(),
	goal1),
	("push_goal 1 b",
	top_goal,
	(),
	goal1)
	];
store_mt_results mt_run [
	("push_goal 1 c",
	top_labelled_goal,
	"",
	goal1)
	];
=TEX
=SML
push_goal goal2;
store_mt_results mt_run [
	("push_goal 2 a",
	top_main_goal,
	(),
	goal2),
	("push_goal 2 b",
	top_goal,
	(),
	goal2)
	];
store_mt_results mt_run [
	("push_goal 2 c",
	top_labelled_goal,
	"",
	goal2)
	];
=TEX
=SML
store_mt_results mt_run_fail [
	("push_goal 30002",
	push_goal,
	([],ª1º),
	gen_fail_msg "push_goal" 30002 ["ª1º"]),
	("push_goal 30003",
	push_goal,
	([ªTº, ª1º, ªFº],ªTº),
	gen_fail_msg "push_goal" 30003 ["ª1º"]),
	("push_goal 30004 a",
	push_goal,
	([ªTº, ªTº],ªTº),
	gen_fail_msg "push_goal" 30004 ["ªTº", "ªTº"]),
	("push_goal 30004 b",
	push_goal,
	([ªÉ x é xº, ªÉ y éyº],ªTº),
	gen_fail_msg "push_goal" 30004 ["ªÉ xé xº", "ªÉ yé yº"])
	];
=TEX
\subsection{push\_goal\_state\_thm}
First get a goal state theorem to test:
=SML
push_goal goal2;
a Ä_tac;
val gst_thm = top_goal_state_thm ();
=TEX
Now try using it:
=SML
push_goal_state_thm gst_thm;
store_mt_results mt_run [
	("push_goal_state_thm a",
	top_main_goal,
	(),
	goal2),
	("push_goal_state_thm b",
	top_goal,
	(),
	sg1_goal2)
	];
store_mt_results mt_run [
	("push_goal_state_thm c",
	top_labelled_goal,
	"1",
	sg1_goal2),
	("push_goal_state_thm c",
	top_labelled_goal,
	"2",
	sg2_goal2)
	];
=TEX
=SML
store_mt_results mt_run_fail [
	("push_goal_state_thm 30005 a",
	push_goal_state_thm,
	t_thm,
	gen_fail_msg "push_goal_state_thm" 30005 ["Ö T"]),
	("push_goal_state_thm 30005 b",
	push_goal_state_thm,
	asm_intro mk_t gst_thm,
	gen_fail_msg "push_goal_state_thm" 30005 [
	"É p q ré p Ä q ä r Ä (É sé s) ä icl'TS p,"^
    "É p q r sé p Ä q ä r Ä (É sé s) ä icl'TS (s Ä (É qé q = 0)), T "^
  "Ö É p q r sé p Ä q ä r Ä (É sé s) ä icl'TS (p Ä s Ä (É qé q = 0))"])
	];
=TEX
\subsection{a(pply\_tactic)}
We need to test for the labelling if none, one or many subgoals are produced,
as well as the various special cases (duplicates, etc).
Note that $a$ is the alias for $apply\_tactic$.

No subgoals:
=SML
push_goal goal4;
a Ä_tac;
a strip_tac;
store_mt_results mt_run [
	("apply_tactic 1",
	top_goal,
	(),
	sg2_goal4)
	];
=TEX
One subgoal:
=SML
push_goal goal3;
a strip_tac;
store_mt_results mt_run [
	("apply_tactic 2",
	top_labelled_goal,
	"",
	sg_goal3)
	];
=TEX
Many subgoals:
=SML
push_goal goal2;
a Ä_tac;
store_mt_results mt_run [
	("apply_tactic 3",
	top_goal,
	(),
	sg1_goal2)
	];
store_mt_results mt_run [
	("apply_tactic 4",
	top_labelled_goal,
	"1",
	sg1_goal2),
	("apply_tactic 5",
	top_labelled_goal,
	"2",
	sg2_goal2)
	];
=TEX
The following checks that distinct free variables with the same names in a pushed goal
causes a suitable failure.
Earlier versions of \cite{DS/FMU/IED/IMP030} would fail unhelpfully when apply tactics to such goals.
=SML
store_mt_results mt_run_fail [(
	"push_goal 30058",
	push_goal,
	goal7,
	gen_fail_msg "push_goal" 30058 ["a"])];
store_mt_results mt_run_fail [(
	("push_goal_state_thm 30058",
	push_goal_state_thm,
	gst1,
	gen_fail_msg "push_goal_state_thm" 30058 ["a"]))];
=TEX
A similar thing occurring in later subgoals is tested by:
=SML
val was_flag = set_flag("subgoal_package_ti_context",false);
push_goal goal8;
a (simple_Ñ_tac ªa:BOOLº);
store_mt_results mt_run [(
	"apply_tac 6",
	top_labelled_goal,
	"",
	([ª(a : '1) = aº],ª(a : BOOL) = aº))];
a id_tac;
store_mt_results mt_run [(
	"apply_tac 7",
	top_labelled_goal,
	"",
	([ª(a : '1) = aº],ª(a : BOOL) = aº))];
a strip_tac;
store_mt_results mt_run [(
	"apply_tac 8",
	dest_thm o top_thm,
	(),
	goal8)];
set_flag("subgoal_package_ti_context",was_flag);
=TEX
The following manifest various information messages,
whose presence must be visually checked for.
Most show the use of message 30037.

Message 30006:
=SML
push_goal goal2;
a (fn (asms,gl) => ([goal2,([ªp Ä qº],ªTº)],fn [thm1,thm2] => 
	prove_asm_rule thm2 thm1
	| _ => t_thm));
=TEX
=SML
push_goal goal2;
a (rewrite_tac[asm_rule ª(É q é q = 0) Ç rº]);
=TEX
Message 30030:
=SML
push_goal goal5;
a Ä_tac;
set_labelled_goal "2";
a (rewrite_tac [Ç_t_intro(asm_rule ªp : BOOLº)]);
=TEX
Message 30032:
=SML
push_goal goal5;
a Ä_tac;
set_labelled_goal "2";
a Ä_tac;
=TEX
Message 30033 and 30036:
=SML
push_goal ([],ªå Fº);
a (fn (asms,gl) => ([goal0],fn [thm1] => 
	f_thm
	| _ => t_thm));
=TEX
Message 30034:
=SML
push_goal goal2;
a id_tac;
=TEX
Message 30035:
=SML
push_goal goal4;
a Ä_tac;
a strip_tac;
=TEX
Now the errors:
=SML
push_goal goal0;
a strip_tac;
store_mt_results mt_run_fail [
	("apply_tactic 30007",
	a,
	strip_tac,
	gen_fail_msg "apply_tactic" 30007 [])
	];
=TEX
=SML
push_goal(goal2);
store_mt_results mt_run_fail [
	("apply_tactic 30008",
	a,
	(fn (_:GOAL) => ([],fn (_:THM list) => t_thm)) : TACTIC,
	gen_fail_msg "apply_tactic" 30008 ["Ö T"])
	];
=TEX
\subsection{pop\_thm}
=SML
push_goal goal2;
push_goal goal0;
a strip_tac;
store_mt_results mt_run [
	("pop_thm 1",
	dest_thm o pop_thm,
	(),
	goal0)
	];
store_mt_results mt_run [
	("pop_thm 2",
	top_main_goal,
	(),
	goal2)
	];
=TEX
Errors:
=SML
push_goal goal2;
store_mt_results mt_run_fail [
	("pop_thm 30011",
	pop_thm,
	(),
	gen_fail_msg "pop_thm" 30011 [])
	];

repeat drop_main_goal;
store_mt_results mt_run_fail [
	("pop_thm 30010",
	pop_thm,
	(),
	gen_fail_msg "pop_thm" 30010 [])
	];
=TEX
\subsection{top\_thm}
=SML
push_goal goal2;
push_goal goal0;
a strip_tac;
store_mt_results mt_run [
	("top_thm 1",
	dest_thm o top_thm,
	(),
	goal0)
	];
store_mt_results mt_run [
	("top_thm 2",
	top_main_goal,
	(),
	goal0)
	];
=TEX
Errors:
=SML
push_goal goal2;
store_mt_results mt_run_fail [
	("top_thm 30011",
	top_thm,
	(),
	gen_fail_msg "top_thm" 30011 [])
	];

repeat drop_main_goal;
store_mt_results mt_run_fail [
	("top_thm 30010",
	top_thm,
	(),
	gen_fail_msg "top_thm" 30010 [])
	];
=TEX
\subsection{save\_pop\_thm}
=SML
push_goal goal2;
push_goal goal0;
a strip_tac;
store_mt_results mt_run [
	("save_pop_thm 1",
	dest_thm o save_pop_thm,
	"save_pop_thm 1",
	goal0)
	];
store_mt_results mt_run [
	("save_pop_thm 2",
	top_main_goal,
	(),
	goal2)
	];
store_mt_results mt_run [
	("save_pop_thm 3",
	dest_thm o get_thm "-",
	"save_pop_thm 1",
	goal0)
	];
=TEX
Errors:
=SML
push_goal goal2;
store_mt_results mt_run_fail [
	("save_pop_thm 30011",
	save_pop_thm,
	"save_pop_thm 30011",
	gen_fail_msg "save_pop_thm" 30011 [])
	];

repeat drop_main_goal;
store_mt_results mt_run_fail [
	("save_pop_thm 30010",
	save_pop_thm,
	"save_pop_thm 30010",
	gen_fail_msg "save_pop_thm" 30010 [])
	];

push_goal goal0;
a strip_tac;
store_mt_results mt_run_fail [
	("save_pop_thm 6039",
	save_pop_thm,
	"save_pop_thm 1",
	gen_fail_msg "save_pop_thm" 6039 ["save_pop_thm 1","test_mdt030"])
	];
=TEX
\subsection{top\_goal\_state\_thm}
=SML
push_goal goal6;
store_mt_results mt_run [
	("top_goal_state_thm 1",
	dest_thm o top_goal_state_thm,
	(),
	([tf_goal6],tf_goal6))
	];
a Ä_tac;
store_mt_results mt_run [
	("top_goal_state_thm 2",
	dest_thm o top_goal_state_thm,
	(),
	([tf_goal6_sg1, tf_goal6_sg2],tf_goal6))
	];
=TEX
Informative Message 30038
=SML
push_goal goal0;
a strip_tac;
top_goal_state_thm ();
=TEX
Errors
=SML
repeat drop_main_goal;
store_mt_results mt_run_fail [
	("top_goal_state_thm 30010",
	top_goal_state_thm,
	(),
	gen_fail_msg "top_goal_state_thm" 30010 [])
	];
=TEX
\subsection{simplify\_goal\_state\_thm}
=SML
push_goal goal0;
a strip_tac;
store_mt_results mt_run [
	("top_goal_state_thm 1",
	dest_thm o simplify_goal_state_thm o top_goal_state_thm ,
	(),
	goal0)
	];
push_goal goal6;
a Ä_tac;
store_mt_results mt_run [
	("simplify_goal_state_thm 2",
	dest_thm o simplify_goal_state_thm o top_goal_state_thm,
	(),
	([stf_goal6_sg1, stf_goal6_sg2, ªp:BOOLº],ªp Ä qº))
	];
=TEX
Errors:
=SML
store_mt_results mt_run_fail [
	("simplify_goal_state_thm 30005",
	simplify_goal_state_thm,
	t_thm,
	gen_fail_msg "simplify_goal_state_thm" 30005 ["Ö T"])
	];
=TEX
\subsection{drop\_main\_goal}
=SML
push_goal goal2;
push_goal goal3;
push_goal goal4;
store_mt_results mt_run [
	("drop_main_goal 1",
	drop_main_goal,
	(),
	goal4),
	("drop_main_goal 2",
	drop_main_goal,
	(),
	goal3),
	("drop_main_goal 3",
	top_main_goal,
	(),
	goal2)
	];
=TEX
Errors
=SML
repeat drop_main_goal;
store_mt_results mt_run_fail [
	("drop_main_goal 30010",
	drop_main_goal,
	(),
	gen_fail_msg "drop_main_goal" 30010 [])
	];
=TEX
\subsection{undo and redo}
=SML
store_mt_results mt_run_fail [
	("undo 30010",
	undo,
	1,
	gen_fail_msg "undo" 30010 [])
	];
push_goal goal4;
a Ä_tac;
a strip_tac;
store_mt_results mt_run [
	("undo 1",
	top_goal,
	(),
	sg2_goal4)
	];
undo 1;
store_mt_results mt_run [
	("undo 2",
	top_goal,
	(),
	sg1_goal4)
	];
redo ();
store_mt_results mt_run [
	("redo",
	top_goal,
	(),
	sg2_goal4)
	];
store_mt_results mt_run_fail [
	("undo 30012 a",
	undo,
	5,
	gen_fail_msg "undo" 30012 ["5","s","2","ies"]),
	("undo 30013",
	undo,
	0,
	gen_fail_msg "undo" 30013 [])
	];
undo 1;
store_mt_results mt_run_fail [
	("undo 30012 b",
	undo,
	2,
	gen_fail_msg "undo" 30012 ["2","s","1","y"])
	];
undo 1;
store_mt_results mt_run_fail [
	("undo 30012 c",
	undo,
	1,
	gen_fail_msg "undo" 30012 ["1","","0","ies"])
	];
push_goal goal4;
a Ä_tac;
store_mt_results mt_run_fail [
	("redo 30014",
	redo,
	(),
	gen_fail_msg "redo" 30014 [])
	];
=TEX
\subsection{set\_labelled\_goal}
=SML
push_goal goal4;
a Ä_tac;
set_labelled_goal "2";
store_mt_results mt_run [
	("set_labelled_goal",
	top_goal,
	(),
	sg2_goal4)
	];
set_labelled_goal "1";
a strip_tac;
store_mt_results mt_run_fail [
	("set_labelled_goal 30041",
	set_labelled_goal,
	"",
	gen_fail_msg "set_labelled_goal" 30041 [""]),
	("set_labelled_goal 30043",
	set_labelled_goal,
	"1",
	gen_fail_msg "set_labelled_goal" 30043 ["1"]),
	("set_labelled_goal 30017 a",
	set_labelled_goal,
	"1.2",
	gen_fail_msg "set_labelled_goal" 30017 ["1.2"]),
	("set_labelled_goal 30017 b",
	set_labelled_goal,
	"3.4",
	gen_fail_msg "set_labelled_goal" 30017 ["3.4"])
	];
=TEX
\subsection{top\_goal\_state and push\_goal\_state}
=SML
push_goal goal4;
a Ä_tac;
a strip_tac;
val tgs = top_goal_state();
push_goal goal0;
a strip_tac;
push_goal_state tgs;

store_mt_results mt_run [
	("top_goal_state/push_goal_state",
	top_goal,
	(),
	sg2_goal4)
	];

repeat drop_main_goal;
store_mt_results mt_run_fail [
	("top_goal_state 30010",
	top_goal_state,
	(),
	gen_fail_msg "top_goal_state" 30010 [])
	];
=TEX
\subsection{print\_goal}
We can only inspect the results of this printing:
=SML
print_goal goal1;
print_goal goal2;
=TEX
\subsection{top\_main\_goal}
Successful uses already tested.
=SML
repeat drop_main_goal;
store_mt_results mt_run_fail [
	("top_main_goal 30025",
	top_main_goal,
	(),
	gen_fail_msg "top_main_goal" 30025 [])
	];
=TEX
\subsection{top\_current\_goal}
Succesful uses already tested.
=SML
repeat drop_main_goal;
store_mt_results mt_run_fail [
	("top_goal 30026 a",
	top_goal,
	(),
	gen_fail_msg "top_goal" 30026 [])
	];
push_goal goal0;
a strip_tac;
store_mt_results mt_run_fail [
	("top_goal 30026 b",
	top_goal,
	(),
	gen_fail_msg "top_goal" 30026 [])
	];
=TEX
\subsection{print\_current\_goal}
Successful use can only be checked by eye.
=SML
push_goal goal4;
print_current_goal();
a Ä_tac;
print_current_goal();

repeat drop_main_goal;
store_mt_results mt_run_fail [
	("print_current_goal 30026 a",
	print_current_goal,
	(),
	gen_fail_msg "print_current_goal" 30026 [])
	];
push_goal goal0;
a strip_tac;
store_mt_results mt_run_fail [
	("print_current_goal 30026 b",
	print_current_goal,
	(),
	gen_fail_msg "print_current_goal" 30026 [])
	];
=TEX
\subsection{top\_labelled\_goal}
Successful uses already tested, except for multi-digit labels:
=SML
push_goal([],ªf 1 Ä f 2 Ä f 3 Ä f 4 Ä f 5 Ä f 6 Ä f 7 Ä f 8 Ä f 9 Ä f 10 Ä f 11 Ä f 12º);
a (REPEAT Ä_tac);
store_mt_results mt_run [ 
	("top_labelled_goal 1",
	top_labelled_goal,
	"12",
	([],ªf 12 : BOOLº))
	];
=TEX
=SML
push_goal goal4;
a Ä_tac;
a strip_tac;
store_mt_results mt_run_fail [
	("top_labelled_goal 30041",
	top_labelled_goal,
	"",
	gen_fail_msg "top_labelled_goal" 30041 [""]),
	("top_labelled_goal 30043",
	top_labelled_goal,
	"1",
	gen_fail_msg "top_labelled_goal" 30043 ["1"]),
	("top_labelled_goal 30017 a",
	top_labelled_goal,
	"1.2",
	gen_fail_msg "top_labelled_goal" 30017 ["1.2"]),
	("top_labelled_goal 30017 b",
	top_labelled_goal,
	"3.4",
	gen_fail_msg "top_labelled_goal" 30017 ["3.4"])
	];
=TEX
subsection{get\_asm}
=SML
push_goal goal4;
store_mt_results mt_run [
	("get_asm 1",
	get_asm,
	1,
	ªp Ä qº),
	("get_asm 2",
	get_asm,
	2,
	ªr Ä (É s é s)º)
	];
store_mt_results mt_run_fail [
	("get_asm 30027 a",
	get_asm,
	0,
	gen_fail_msg "get_asm" 30027 ["0"]),
	("get_asm 30027 b",
	get_asm,
	5,
	gen_fail_msg "get_asm" 30027 ["5"])
	];
repeat drop_main_goal;
store_mt_results mt_run_fail [
	("get_asm 30026",
	get_asm,
	1,
	gen_fail_msg "get_asm" 30026 [])
	];
=TEX
\subsection{top\_goals}
=SML
store_mt_results mt_run_fail [
	("top_goals 30010",
	top_goals,
	(),
	gen_fail_msg "top_goals" 30010 [])
	];

push_goal goal4;
a Ä_tac;
store_mt_results mt_run [
	("top_goals 1",
	top_goals,
	(),
	[(["1"], sg1_goal4), (["2"], sg2_goal4)])
	];
push_goal goal5;
a (REPEAT strip_tac);
store_mt_results mt_run [
	("top_goals 2",
	top_goals,
	(),
	[(["2", "1"], sg1_goal5),(["3"], sg3_goal5)])
	];
=TEX
\subsection{print\_goal\_state}
Results can only be inspected by eye:
=SML
push_goal goal4;
print_goal_state(top_goal_state());
a Ä_tac;
print_goal_state(top_goal_state());
=TEX
\subsection{modify\_goal\_state\_thm}
First a null-change:
=SML
push_goal goal5;
a(REPEAT strip_tac);
modify_goal_state_thm (Combinators.I) (top_goals());
store_mt_results mt_run [
	("modify_goal_state_thm 1",
	top_goals,
	(),
	[(["1", "2"], sg1_goal5),(["3"], sg3_goal5)])
	];
=TEX
Now a bit of relabelling:
=SML
modify_goal_state_thm (Combinators.I) [];
store_mt_results mt_run [
	("modify_goal_state_thm 2",
	top_goals,
	(),
	[(["2"], sg1_goal5),(["1"], sg3_goal5)])
	];
=TEX
Now some rearrangement (which gives message 30024):
=SML
val s1 = asm_rule ªÉ p é icl'TS (p Ç T)º;
val s2 = rewrite_rule[get_defn "misc" "icl'TS"] s1;
modify_goal_state_thm (strip_ä_rule o 
	pure_rewrite_rule [all_simple_É_elim s2] o all_ä_intro) [];
store_mt_results mt_run [
	("modify_goal_state_thm 3",
	top_goals,
	(),
	[(["3"], ([], ªp Ç Tº)), 
	 (["2"], ([ªT Ä qº, ªr Ä (É s é s)º], ªTº)),
	 (["1"], ([ªT Ä qº, ªr Ä (É s é s)º], ªq:BOOLº))])
	];
=TEX
Errors:
=SML
push_goal goal5;
a(REPEAT strip_tac);
store_mt_results mt_run_fail [
	("modify_goal_state_thm 30039",
	modify_goal_state_thm (Combinators.I),
	[(["1"],sg1_goal5), (["1.2"],sg3_goal5)],
	gen_fail_msg "modify_goal_state_thm" 30039 ["1", "1.2"]),
	("modify_goal_state_thm 30040",
	modify_goal_state_thm (Combinators.I),
	[(["1"],sg1_goal5), (["1"],sg3_goal5)],
	gen_fail_msg "modify_goal_state_thm" 30040 ["1"]),
	("modify_goal_state_thm 30051",
	modify_goal_state_thm (fn x => t_thm),
	[(["1"],sg1_goal5), (["2"],sg3_goal5)],
	gen_fail_msg "modify_goal_state_thm" 30051 ["Ö T"])
	];
=TEX
\subsection{A Quiet Proof}
The following should have no output bar the results of values.
=SML
diag_string "Going Quiet";
set_flag("subgoal_package_quiet",true);
push_goal([],ªT Ä Tº);
a(Ä_tac);
a(accept_tac t_thm);
val quiet_thm = pop_thm();
=TEX
Now do it again ``noisily''
=SML
diag_string "Becoming Noisy";
set_flag("subgoal_package_quiet",false);
push_goal([],ªT Ä Tº);
a(Ä_tac);
a(accept_tac t_thm);
val quiet_thm = pop_thm();
=TEX
\subsection{Type Inference Contexts}
=SML
set_flag("subgoal_package_ti_context",true);
push_goal([],ªx:'b = xº);
store_mt_results mt_run [("subgoal_package_context 1",
	type_of,
	ªxº,
	ª:'bº)];
a(rewrite_tac[]);
store_mt_results mt_run [("subgoal_package_context 2",
	type_of,
	ªxº,
	ª:'aº)];
set_flag("subgoal_package_ti_context",false);
push_goal([],ªx:'b = xº);
store_mt_results mt_run [("subgoal_package_context 3",
	type_of,
	ªxº,
	ª:'aº)];
a(rewrite_tac[]);
store_mt_results mt_run [("subgoal_package_context 4",
	type_of,
	ªxº,
	ª:'aº)];
set_flag("subgoal_package_ti_context",true);
=TEX
=SML
The following ensures that the goal printing is using the
right translations.
Unfortunately, the effect can only be checked by inspecting
the output of the tests, where the goals should be displayed in
the obvious form.
Version 1.13 and before of \cite{DS/FMU/IED/IMP030}
would give a corrupted output involving many more ``Q''s than input.
=SML
push_goal([ªQ = QQº],ªÉ Q QQ QQQ QQQQ x é (x = Q) Å (x = QQ) Å (x = QQQ) Å (x = QQQQ)º);
=TEX
\section{END OF TESTS}
=SML
summarize_mt_results();
=TEX
Undo theory creation, etc
=SML
(*
open_theory start_theory;
delete_theory "test_mdt030";
*)
(* PolyML.quit(); *)
=TEX
\section{UNTESTED ERROR MESSAGES}
The following are not tested for various reasons:

\begin{tabular}{| l | p{4.5in} |}\hline
Test & Comment \\ \hline
\hline
\end{tabular}
=TEX
\twocolumn[\section{INDEX}]
\small
\printindex
=TEX
\end{document}
