=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{FST PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{HOL PDS System Initialisation}  %% Mandatory field
\TPPref{DS/FMU/IED/DTD036}  %% Mandatory field
\def\SCCSversion{$Revision$%
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}  
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{HOL}
\TPPauthor{R.D.~Arthan & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.D.~Arthan & FST Team Leader}
\TPPabstract{
This document contains the detailed design for the module of the ICL HOL
system responsible for system initialisation.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	Library\\RDA\\AJH\\DJK}}

%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents list}
\tableofcontents
\subsection{Document cross references}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes history}  % to get section number `0.3'
\begin{description}
\item[Issue 1.1]
First draft for comment.

\item[Issue \SCCSversion, \FormatDate{92/01/20} ] Updated to use new fonts.

\end{description}
\subsection{Changes forecast}
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document contains the detailed design for the module in ICL HOL responsible
for system initialisation and close-down
as called for in the high-level design document
\cite{DS/FMU/IED/HLD008}.

The implementation for this design is given in \cite{DS/FMU/IED/IMP036}.
\subsection{Introduction}
Facilities are required to allow various functions (nominated during construction
of the HOL system or by an extender of the system) to be invoked at the start
of each session. Examples include output of a banner message at the start of
a session, accessing command line options, and performing compiler-specific
initialisation  (e.g. to set up pretty printing with PolyML).

We also need to supply the means whereby the user saves his work and ends a
session. These facilities are defined here.

\subsection{Dependencies}
This document depends only on Standard ML facilities.
The implementation will depend on compiler-specific features for
saving the Standard ML state.
\subsection{Possible Enhancements}
None known.
\subsection{Deficiencies}
None known.

\section{USER INTERFACES}
=DOC
signature ÛHOLSystemÝ = sig
=DESCRIBE
This is the signature of the structure $HOLSystem$ which contains
functions used to end a HOL session and to save the results of a HOL session.
=ENDDOC
=DOC
val	Ûhol_quitÝ : unit -> unit
=DESCRIBE
$hol\_quit()$ is used to end a session with the hol system. In interactive
use, if changes have been made to any theory during the session, a warning
message is output and the user is asked whether to quit or not.
If there any changes which have not been saved when $hol\_quit$
is used non-interactively,
then a message to this effect will be output and the session will end without
the changes being saved.
=ENDDOC
=FAILURE
36001	Not all changes to the theory database have been saved (using hol_save) in this session
=TEX
=DOC
val	Ûhol_saveÝ : unit -> unit
=DESCRIBE
$hol\_save()$ is used to update the filestore copy of the theory database
to reflect any changes made in the current session.
=ENDDOC
=SML
end; (* of signature HOLSystem *)
=TEX
\section{SYSTEM INITIALISATION}
=DOC
signature ÛInitialisationÝ = sig
=DESCRIBE
This is the signature of the structure $HOLInitialisation$ which contains
functions which may be used to add and test new start of session functions.
These functions are for use by those extending the system.
=ENDDOC
=DOC

val	Ûnew_init_funÝ : (unit -> unit) -> unit
=DESCRIBE
$new\_init\_fun$ adds a new entry to a table of functions which are invoked
at the start of each session. At the beginning of each session, these functions
are executed in turn, with the function stored by the most recent use
of $new\_init\_fun$ executed last.

Since the table is stored in the Standard ML object code of the ICL HOL system itself,
this function is only effective when used to extend the ICL HOL system by
adding to that code.
System extenders are reminded that entries cannot be deleted from the table.
=USES
For use
in extending the system (e.g. to add extra messages to the start of
session message).
=ENDDOC

In the supplied system for PolyML, the table needs to contain function which
do the following:

\begin{enumerate}
\item output the start of session banner message (see below);
\item initialise any modules which have an associated start of session initialisation function;
\item extract the name of the desired current hierarchy  (as given on
the command line which invoked the HOL system) from the
environment variable $HOLHIERARCHY$, and load that hierarchy. (This is the
interface to the shell scripts used to invoke HOL described in
\cite{DS/FMU/IED/HLD005}).
\end{enumerate}

=DOC
val	ÛinitÝ : unit -> unit
=DESCRIBE
$init$ causes the initialisation functions in the table maintained
by $new\_init\_fun$ to be executed, as they would be at the start of
a session.
=USES
Mainly for use in testing extensions to the system.
=SEEALSO
$new\_init\_fun$.
=ENDDOC
The following is the banner message to be output when a session
begins. The ``$?0$'' is to be set to the value of the variable
$system\_version$ which is set up in \cite{DS/FMU/IED/IMP021}
to give a version number for the system build.
=FAILURE
36000	=== ICL HOL Version (1.?0) Copyright (C) ICL 1991 ===
=TEX
\section{EPILOGUE}
=SML
end; (* of signature Initialisation *)
=TEX
=SML
=TEX
\section{TEST POLICY}
The functions in this document should be tested as described in
\cite{DS/FMU/IED/PLN008}. However,  only the function $init$ may
be tested in any useful way via the usual module test mechanism,
since assessing the operation of the other functions requires the
HOL session to be ended and restarted. Thus these functions will
be checked out in the interactive integration tests.
\small
\twocolumn[\section{INDEX}]
\printindex
\end{document}




