=IGN
********************************************************************************
mdt122.doc: this file is part of the PPHol system

Copyright (c) 2002 Lemma 1 Ltd.

See the file LICENSE for your rights to use and change this file.

Contact: Rob Arthan < rda@lemma-one.com >
********************************************************************************
=TEX
\documentclass[a4paper,12pt]{article}

%%%%% YOU CAN ADD OTHER PACKAGES AS NEEDED BELOW:
\usepackage{A4}
\usepackage{Lemma1}
\usepackage{ProofPower}
\usepackage{epsf}
\makeindex

\def\Title{UTF-8 and Unicode Support: Module Tests }

\def\Abstract{\begin{center}
{\bf Abstract}\par\parbox{0.7\hsize}
{\small This document gives the module tests for utilities to support UTF-8 and Unicode.}
\end{center}}

\def\Reference{LEMMA1/HOL/MDT122}

\def\Author{R.D. Arthan}

\def\EMail{{\tt rda@lemma-one.com}}

\def\Phone{+44 118 958 4409}

\def\Fax{+44 118 956 1920}

%%%%% YOU MAY WANT TO CHANGE THE FOLLOWING TO GET A NICE FRONT PAGE:
\def\FrontPageTitle{ {\huge \Title } }
\def\FrontPageHeader{\raisebox{16ex}{\begin{tabular}[t]{c}
\bf Copyright \copyright\ : Lemma 1 Ltd \number\year\\\strut\\
\end{tabular}}}
\begin{centering}



\end{centering}

%%%%% THE FOLLOWING DEFAULTS WILL GENERALLY BE RIGHT:

\def\Version{1.7%
}
\def\Date{\FormatDate{2002/10/17 16:20:01%
}}

%%%%% NOW BEGIN THE DOCUMENT AND MAKE THE FRONT PAGE

\begin{document}
\headsep=0mm
\FrontPage
\headsep=10mm

%%%%% STANDARD RED-TAPE SECTIONS (MAY WANT TO INTERLEAVE SOME \newpage COMMANDS IN THESE)

%%%%% CONTENTS:

\subsection{Contents}

\tableofcontents

%%%%% REFERENCES:

\newpage
\subsection{References}

\bibliographystyle{fmu}

%%%%% CHANGE THE FOLLOWING AS NECESSARY (E.G., TO PICK UP daz.bib):
{\raggedright
\bibliography{fmu}
}
%%%%% CHANGES HISTORY:
\subsection{Changes History}
\begin{description}
\item[Issue 1.1 (2010/10/16)] First draft.
\item[2014/07/23]
Augmented old RCS version numbers in the changes history with dates.
Dates will be used in place of version numbers in future.
\item[2015/02/23--2015/02/24]
Under development.
%%%% END OF CHANGES HISTORY %%%%
\end{description}

%%%%%  CHANGES FORECAST:

\subsection{Changes Forecast}

None.

%%%%% DISTRIBUTION LIST

\subsection{Distribution}

Lemma 1 build system.

\newpage

\section{INTRODUCTION}
\subsection{Scope}
This document contains the module tests associated with the tools for querying the theory hierarchy to find theorems satisfying specified conditions.
required by \cite{DS/FMU/IED/DTD120} and
implemented in \cite{DS/FMU/IED/IMP120}.
\subsection{Introduction}
\subsubsection{Purpose and Background}
See \cite{DS/FMU/IED/DTD040}.
\subsubsection{Dependencies}
The test material depends on \cite{DS/FMU/IED/DTD013} and \cite{DS/FMU/IED/IMP013}.

\subsubsection{Deficiencies}
None known.
\section{INITIALISATION}
Initialise the test package:
=SML
use_file "dtd013.sml";
use_file "imp013.sml";
init_mt_results ();
=TEX
\section{TEST CASES}
\begin{description}
\item[Group A]
Edge cases for encoding with hand-calculated inputs and outputs;
\item[Group B]
Edge cases for decoding with hand-calculated inputs and outputs;
\item[Group C]
Soak test for the encoder using the decoder as an oracle;
\item[Group D]
Soak test for the decoder using the encoder as an oracle.
\item[Group E]
Tests for error cases.
\end{description}
\section{THE TESTS}
=TEX
\subsection{Group A}
=SML
val encode_to_word_list = map (Word.fromInt o ord) o explode o encode_utf8;
store_mt_results
mt_run [
	("122.A.1", encode_to_word_list, 0wx000000, [0wx00]),
	("122.A.2", encode_to_word_list, 0wx00007f, [0wx7f]),
	("122.A.3", encode_to_word_list, 0wx000080, [0wxC2, 0wx80]),
	("122.A.4", encode_to_word_list, 0wx0007ff, [0wxDF, 0wxBF]),
	("122.A.5", encode_to_word_list, 0wx000800, [0wxE0, 0wxA0, 0wx80]),
	("122.A.6", encode_to_word_list, 0wx00FFFF, [0wxEF, 0wxBF, 0wxBF]),
	("122.A.7", encode_to_word_list, 0wx010000, [0wxF0, 0wx90, 0wx80, 0wx80]),
	("122.A.8", encode_to_word_list, 0wx10FFFF, [0wxF4, 0wx8F, 0wxBF, 0wxBF])
];
=TEX
\subsection{Group B}
=SML
fun string_stream ((s, i) : string * int) : char OPT * (string * int) = (
	if	i < size s
	then	(Value (String.sub(s, i)), (s, i + 1))
	else	(Nil, (s, i))
);
fun decode_utf8_s s = (
	case decode_utf8 string_stream (s, 0) of
		Value (Value w, (s, i)) => Value (w, String.extract(s, i, NONE))
	|	_ => Nil
);
val decode_from_word_list = force_value o decode_utf8_s o implode o map (chr o Word.toInt);
=TEX
=SML
store_mt_results
mt_run [
	("122.B.1", decode_from_word_list, [0wx00, 0wx21], (0wx000000, "!")),
	("122.B.2", decode_from_word_list, [0wx7f, 0wx21], (0wx00007f, "!")),
	("122.B.3", decode_from_word_list, [0wxC2, 0wx80, 0wx21], (0wx000080, "!")),
	("122.B.4", decode_from_word_list, [0wxDF, 0wxBF, 0wx21], (0wx0007ff, "!")),
	("122.B.5", decode_from_word_list, [0wxE0, 0wxA0, 0wx80, 0wx21], (0wx000800, "!")),
	("122.B.6", decode_from_word_list, [0wxEF, 0wxBF, 0wxBF, 0wx21], (0wx00FFFF, "!")),
	("122.B.7", decode_from_word_list, [0wxF0, 0wx90, 0wx80, 0wx80, 0wx21], (0wx010000, "!")),
	("122.B.8", decode_from_word_list, [0wxF4, 0wx8F, 0wxBF, 0wxBF, 0wx21], (0wx10FFFF, "!"))
];
=TEX
\subsection{Group C}
=SML
val all_cps = map Word.fromInt (interval 0 0x10FFFF);
val all_encs = map encode_utf8 all_cps;
fun decode_utf8_all s = (
	let	fun aux acc st = (
			case decode_utf8 string_stream st of
				Value (Value w, st') => aux (w::acc) st'
			|	Value (Nil, _) => rev acc
			|	Nil => fail "" 0 []
		);
	in	aux [] (s, 0)
	end
);
fun iter f n x = if n <= 0 then x else iter f (n - 1) (f x);
fun riffle [] r = r
|   riffle l [] = l
|   riffle (x::l) (y::r) = x :: y :: riffle l r;
fun shuffle xs = (
	let	val m = length xs div 2;
		val l = xs to (m - 1);
		val r = xs from m;
	in	riffle l r
	end
);
=TEX
=SML
store_mt_results
mt_run [
	("122.C.1", decode_utf8_all, implode all_encs, all_cps),
	("122.C.2", decode_utf8_all, (implode o iter shuffle 5) all_encs, iter shuffle 5 all_cps)
];
=TEX
\subsection{Group D}
=TEX
=SML
=TEX
=SML
store_mt_results
mt_run [
	("122.D.1", map (encode_utf8 o fst o force_value o decode_utf8_s), all_encs, all_encs)
];
=TEX
\subsection{Group E}
=SML
store_mt_results
mt_run_fail[
	("122.E.1.1", encode_utf8, 0wx110000, gen_fail_msg "encode_utf8" 122001 [])
];
=TEX
=SML
val string_from_words = implode o map (chr o Word.toInt);
store_mt_results
mt_run [
	("122.E.2.1", decode_utf8_s o string_from_words, [0wxC0, 0wx80, 0wx80, 0wx80, 0wx80], Nil),
	("122.E.2.2", decode_utf8_s o string_from_words, [0wxFF, 0wx80, 0wx80, 0wx80, 0wx80], Nil),
	("122.E.2.3", decode_utf8_s o string_from_words, [0wxE0, 0wx80, 0wx80], Nil)
];
=TEX
\section{END OF TESTS}
=SML
diag_string(summarize_mt_results());
=TEX
\end{document}







