%  $Id$ %Z%
=TEX
\documentstyle[hol,11pt,TQ]{article}
\ftlinepenalty=9999
\makeindex
\TPPproject{IED 1563}  %% Mandatory field
\TPPtitle{Implementation for the General Purpose Theories}  %% Mandatory field
\def\TPPheadtitle{Implementation for the General Purpose Theories}
\TPPref{DS/FMU/IED/IMP045}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$ %
}}  %% Mandatory field
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{SML Literate Script}
\TPPkeywords{}
\TPPauthor{K.~Blackburn & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.D.Arthan & FST Team Leader}
\TPPabstract{This document creates the theories
``one'', ``combin'' and ``sum''.}
\TPPdistribution{\parbox[t]{4.0in}{%
	    Project Library
}}
%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}
\begin{document}
\makeTPPfrontpage
\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}
\pagebreak
\section{Document Control}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History}
\begin{description}
\item [Issue 1.1]
First version.
\item [Issue 1.2]
Taken $ext\_thm$ from elsewhere, and used $ante\_tac$.
\end{description}
% \subsection{Changes Forecast}
\section{GENERAL}
\subsection{Scope}
This document contains an implementation of the general purpose theories.
This is called for in \cite{DS/FMU/IED/HLD011}.
The design is in \cite{DS/FMU/IED/DTD045}.
\subsection{Introduction}
\subsubsection{Purpose and Background}
This document contains an implementation of the 
general purpose theories.
\subsubsection{Dependencies}
This document takes its signature from \cite{DS/FMU/IED/DTD045},
and also requires the theory ``pair'' defined in
\cite{DS/FMU/IED/DTD037}.
However, the actual parent will eventualy be $set$.
\subsubsection{Deficiencies}
Parentage in doubt!
\subsubsection{Possible Enhancements}
None known.
\section{THE THEORY ``one''}
=SML
structure âOneTheoryá : OneTheory = struct
val _ = new_theory "one";
=TEX
=SML
val _ = new_specification(["IsOneRep"],1, (
push_goal([],»„ IsOneRep:BOOL ‹ BOOL Ž
	„ one : BOOL Ž 
	ƒ x: BOOLŽ IsOneRep x ‚ (x ‚ one)¼);
a(simple_„_tac» x Ž x = T¼ THEN 
 simple_„_tac»T¼ THEN
 rewrite_tac[]);
pop_thm()));
=TEX
=SML
val _ = new_type_defn("ONE","ONE",[],(
push_goal([],»„ x: BOOL Ž IsOneRep x¼);
a(strip_asm_tac (get_defn "-" "IsOneRep"));
a(simple_„_tac »one:BOOL¼ THEN
  asm_rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âone_defá = new_specification(["One"],1,(
push_goal([],»„ One : ONE Ž ƒ x: ONEŽ x = One¼);
a (strip_asm_tac (simple_Š_match_mp_rule type_lemmas_thm
	(get_defn "-" "ONE")));
a(strip_asm_tac (get_defn "-" "IsOneRep"));
a(simple_„_tac »abs (one:BOOL):ONE¼);
a simple_ƒ_tac;
a(GET_NTH_ASM_T 2 (fn th1 => DROP_NTH_ASM_T 1 (fn th2
	=> ante_tac (rewrite_rule [th1] th2))));
a(Š_T (ante_tac o simple_ƒ_elim »rep (x:ONE):BOOL¼));
a(asm_rewrite_tac[]);
a(Š_T (fn x=> asm_rewrite_tac[eq_sym_rule x]));
pop_thm()));
=TEX
=SML
val âone_fns_thmá = save_thm("one_fns_thm",(
push_goal([],»ƒ f: 'a ‹ ONE Ž f =  x Ž One¼);
a(rewrite_tac[ext_thm,one_def]);
pop_thm()));
=TEX
\subsection{End of Theory ``one''}
=SML
end; (* of structure OneTheory *)
open OneTheory;
=TEX
\section{THE THEORY ``combin''}
=SML
structure CombinTheory : CombinTheory = struct
val _ = new_theory "combin";
=TEX
=SML
val _ = declare_infix (300, "o");
val âo_defá = new_specification(["o"],1,(
push_goal([],»„ $o Ž ƒ (f:'b ‹ 'c) (g:'a ‹ 'b) (x: 'a) Ž
	(f o g) x = f(g x)¼);
a(simple_„_tac » (f:'b ‹ 'c) (g:'a ‹ 'b) (x: 'a) Ž f(g x)¼ THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âs_defá = new_specification(["S"],1,(
push_goal([],»„ S Ž ƒ (f:'a ‹ 'b ‹ 'c) (g:'a ‹ 'b) (x:'a) Ž
	S f g x = f x (g x)¼);
a(simple_„_tac » (f:'a ‹ 'b ‹ 'c) (g:'a ‹ 'b) (x:'a) Ž
	f x (g x)¼ THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âk_defá = new_specification(["K"],1,(
push_goal([],»„ K Ž ƒ (x : 'a) (y : 'b) Ž K x y = x¼);
a(simple_„_tac » (x : 'a) (y : 'b) Ž x¼ THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âi_defá = new_specification(["I"],1,(
push_goal([],»„ I Ž ƒ (x : 'a) Ž I x = x¼);
a(simple_„_tac » (x : 'a) Ž x¼ THEN rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âs_k_thmá = save_thm ("s_k_thm", (
push_goal([],»ƒ x Ž (S:('a ‹ 'b ‹ 'a) ‹ ('a ‹ 'b) ‹ 'a ‹ 'a) K x = I¼);
a(simple_ƒ_tac THEN rewrite_tac[ext_thm, s_def, k_def, i_def]);
pop_thm()));
=TEX
=SML
val âo_assoc_thmá = save_thm ("o_assoc_thm",(
push_goal([],»ƒ (f:'a ‹ 'b) (g:'c ‹ 'a) (h :'d ‹ 'c)Ž 
	f o (g o h) = (f o g) o h¼);
a(REPEAT simple_ƒ_tac THEN rewrite_tac[ext_thm,o_def]);
pop_thm()));
=TEX
=SML
val âo_i_thmá = save_thm ("o_i_thm",(
push_goal([],»ƒ f : 'a ‹ 'bŽ
	((I o f) = f) € ((f o I) = f)¼);
a(REPEAT simple_ƒ_tac THEN rewrite_tac[ext_thm,o_def, i_def]);
pop_thm()));
=TEX
\subsection{End of Theory ``combin''}
=SML
end; (* of struct CombinTheory *)
open CombinTheory;
=TEX
\section{THE THEORY ``sum''}
=SML
structure SumTheory : SumTheory = struct
val _ = new_theory "sum";
=TEX
=SML
val âis_sum_rep_defá = new_specification(["IsSumRep"],1,(
push_goal([],»„ IsSumRep Ž 
„ (inl:'a ‹  'a ‰ 'b ‰ BOOL) (inr:'b ‹  'a ‰ 'b ‰ BOOL)
  (outl:'a ‰ 'b ‰ BOOL ‹ 'a) (outr:'a ‰ 'b ‰ BOOL ‹ 'b)
  (isl:'a ‰ 'b ‰ BOOL ‹ BOOL) (isr:'a ‰ 'b ‰ BOOL ‹ BOOL) Ž
ƒ (x1:'a) (x2:'a) (y1:'b) (y2:'b) (z: 'a ‰ 'b ‰ BOOL) Ž
	IsSumRep(inl x1) €
	IsSumRep(inr y1) €
	(IsSumRep z Š (inl(outl z) = z  inr(outr z) = z)) €
	(inl x1 = inl x2 ‚ x1 = x2) €
	(inr y1 = inr y2 ‚ y1 = y2) €
	Œ(inl x1 = inr y1) €
	Œ(inr y1 = inl x1) €
	outl(inl x1) = x1 €
	outr(inr y1) = y1 €
	(IsSumRep z Š (isl z ‚ inl(outl z) = z)) €
	(IsSumRep z Š (isr z ‚ inr(outr z) = z))
	¼);
a(MAP_EVERY simple_„_tac [
	» ((a:'a), (b:'b), c) Ž 
	 if c then (b = ‡ x ŽT) else (a = ‡ yŽT)¼,
	» a:'aŽ (a, (‡ x:'b ŽT), T)¼,
	» b:'bŽ ((‡ y:'a ŽT), b, F)¼,
	» ((a:'a), (b:'b), (c:BOOL)) Ž a¼,
	» ((a:'a), (b:'b), (c:BOOL)) Ž b¼,
	» ((a:'a), (b:'b), (c:BOOL)) Ž c¼,
	» ((a:'a), (b:'b), c) Ž Œ c¼]
	THEN rewrite_tac[pair_clauses]);
a(REPEAT strip_tac THEN (asm_rewrite_tac[pair_clauses] ORELSE_T id_tac));
(* *** Goal "1" *** *)
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[pair_clauses]);
(* *** Goal "2" *** *)
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[pair_clauses]);
(* *** Goal "3" *** *)
a(POP_ASM_T ante_tac THEN asm_rewrite_tac[pair_clauses]);
pop_thm()));
=TEX
=SML
val _ = declare_infix (120,"+");
val âsum_defá = new_type_defn("+","+",["'a","'b"],(
push_goal([],»„ x: 'a ‰ 'b ‰ BOOL Ž IsSumRep x¼);
a(strip_asm_tac (get_defn "-" "IsSumRep"));
a(simple_„_tac»inl (x:'a):'a ‰ 'b ‰ BOOL¼);
a(asm_rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âsum_clausesá = new_specification(["InL", "InR", "OutL", "OutR", "IsL", "IsR"],6,(
push_goal([],»
„ InL InR OutL OutR IsL IsR Ž
ƒ (x1:'a) (x2:'a) (y1:'b) (y2:'b) (z: 'a + 'b) Ž
	(InL(OutL z) = z  InR(OutR z) = z) €
	((InL x1 : 'a + 'b) = InL x2 ‚ x1 = x2) €
	((InR y1 : 'a + 'b) = InR y2 ‚ y1 = y2) €
	Œ(InL x1 = InR y1) €
	Œ(InR y1 = InL x1) €
	OutL(InL x1:'a + 'b) = x1 €
	OutR(InR y1:'a + 'b) = y1 €
	(IsL z ‚ InL(OutL z) = z) €
	(IsR z ‚ InR(OutR z) = z)
	¼);
a (strip_asm_tac (simple_Š_match_mp_rule type_lemmas_thm
	(get_defn "-" "+")));
a(strip_asm_tac (get_defn "-" "IsSumRep"));
a(MAP_EVERY simple_„_tac
	[»(abs o (inl : 'a ‹ 'a ‰ 'b ‰ BOOL)):'a ‹ 'a + 'b¼,
	»(abs o (inr : 'b ‹ 'a ‰ 'b ‰ BOOL)):'b ‹ 'a + 'b¼,
	»((outl:'a ‰ 'b ‰ BOOL ‹ 'a) o rep):'a + 'b ‹ 'a¼,
	»((outr:'a ‰ 'b ‰ BOOL ‹ 'b) o rep):'a + 'b ‹ 'b¼,
	»((isl:'a ‰ 'b ‰ BOOL ‹ BOOL) o rep):'a + 'b ‹ BOOL¼,
	»((isr:'a ‰ 'b ‰ BOOL ‹ BOOL) o rep):'a + 'b ‹ BOOL¼]
);
a(REPEAT simple_ƒ_tac THEN rewrite_tac[o_def]);
a(GET_NTH_ASM_T 2 (fn th1 => DROP_NTH_ASM_T 1 (fn th2
	=> ante_tac (rewrite_rule [th1] th2))));
a(Š_T(ante_tac o all_ƒ_intro o list_simple_ƒ_elim [
	»x1: 'a¼, »x2: 'a¼, »y1: 'b¼, »y2: 'b¼, »rep (z:'a+'b):'a ‰ 'b ‰ BOOL¼]));
a(asm_rewrite_tac[]);
a(Š_T(MAP_EVERY (asm_tac o all_ƒ_intro) o
	(strip_€_rule o all_simple_ƒ_elim)));
a(asm_rewrite_tac[]);
a(REPEAT strip_tac);
(* *** Goal "1" *** *)
a(DROP_NTH_ASM_T 10 (strip_asm_tac o all_simple_ƒ_elim));
(* *** Goal "1.1" *** *)
a(undisch_tac(get_asm 2) THEN asm_rewrite_tac[]);
(* *** Goal "1.2" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "2" *** *)
a(DROP_NTH_ASM_T 1 (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
(* *** Goal "3" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "4" *** *)
a(DROP_NTH_ASM_T 1 (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
(* *** Goal "5" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "6" *** *)
a(Œ_tac »T¼ THEN (rewrite_tac[] ORELSE_T accept_tac t_thm));
a(POP_ASM_T (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
(* *** Goal "7" *** *)
a(Œ_tac »T¼ THEN (rewrite_tac[] ORELSE_T accept_tac t_thm));
a(POP_ASM_T (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
(* *** Goal "8" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "9" *** *)
a(POP_ASM_T (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
(* *** Goal "10" *** *)
a(asm_rewrite_tac[]);
(* *** Goal "11" *** *)
a(POP_ASM_T (ante_tac o ap_fun_rule »rep:'a + 'b ‹ ('a ‰ 'b ‰ BOOL)¼)
	THEN asm_rewrite_tac[]);
pop_thm()));
=TEX
=SML
val âsum_cases_thmá = save_thm("sum_cases_thm",
	all_ƒ_intro(hd(strip_€_rule(all_simple_ƒ_elim sum_clauses))));
=TEX
=SML
val âsum_fns_thmá = save_thm("sum_fns_thm",(
push_goal([],»ƒ (f: 'a ‹ 'c) (g: 'b ‹ 'c) Ž
	„%down%1 h: 'a + 'b ‹ 'c Ž
	h o InL = f € h o InR = g¼);
a(REPEAT strip_tac);
a(conv_tac simple_„%down%1_conv);
a(simple_„_tac » x:'a+'bŽ
	if IsL x then ((f: 'a ‹ 'c)(OutL x)) else ((g: 'b ‹ 'c)(OutR x))¼);
a(rewrite_tac[ext_thm, o_def,sum_clauses]);
a(REPEAT strip_tac);
a(_THEN asm_tac (simple_ƒ_elim »x'¼ sum_cases_thm));
(* *** Goal "1" *** *)
a(POP_ASM_T (fn x=> once_rewrite_tac[eq_sym_rule x]));
a(asm_rewrite_tac[sum_clauses]);
(* *** Goal "2" *** *)
a(POP_ASM_T (fn x=> once_rewrite_tac[eq_sym_rule x]));
a(asm_rewrite_tac[sum_clauses]);
pop_thm()));
=TEX
\subsection{End of Theory ``sum''}
=SML
end; (* of struct SumTheory *)
open SumTheory;
=TEX
\newpage
\twocolumn[\section{INDEX}]
\small
\printindex
\end{document}
