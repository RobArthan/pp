%  dtd508.doc %Z% $Date$ $Revision$ $RCSfile$
=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DAZ PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Detailed Design: Declaration and Expression Generator}  %% Mandatory field
\TPPref{ISS/HAT/DAZ/DTD508}  %% Mandatory field
\def\SCCSversion{$Revision$%
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}
%\TPPstatus{Approved}
\TPPstatus{Draft}
\TPPtype{Specification}
\TPPkeywords{SPARK}
\TPPauthor{D.J.~King&WIN01}
\TPPauthorisation{R.D.~Arthan & HAT Team}
\TPPabstract{
}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	Library}}

%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,daz}

\subsection{Changes History}  % to get section number `0.3'
\begin{description}
\item[Issue \SCCSversion~\FormatDate{$Date$%
}) ] Initial Draft.

\end{description}
\subsection{Changes Forecast}
\section{GENERAL}
\subsection{Scope}
This document contains the detailed design for the Web Clause Processor.

\subsection{Introduction}

\subsubsection{Purpose and Background}


\subsubsection{Dependencies}
%\subsubsection{Possible Enhancements}
\subsubsection{Deficiencies}
None known.

\section{PREAMBLE}
=DOC
signature ÛCNBasicDeclsAndExprsÝ = sig
local
	open CNTypes ZProofMode;
in
=DESCRIBE
=FAILURE
508001	?0
=ENDDOC

\section{THE ENVIRONMENT}
=SML
datatype ÛENV_INFOÝ =
			ÛEIEnvFunctionÝ of ID list
		|	ÛEIEnvRecordAggÝ
		|	ÛEIEnvVarÝ
		|	ÛEIEnvOtherÝ
type ÛCN_ENVÝ
=TEX

\section{ABSTRACT SYNTAX OF Z}

=DOC
type ÛZ_DECLÝ
type ÛZ_MODULEÝ
=DESCRIBE
=ENDDOC

\section{TRANSLATING SPARK EXPRESSIONS}

\subsection{Translating Identifiers}
¹ZAX
Ü	trans_id : ID ­ Z_ID
°

=DOC
val Ûtrans_idÝ : ID -> Z_ID
=FAILURE
=ENDDOC
¹Z
Ü	zfst ¦ trans_id fst
°
¹Z
Ü	zlst ¦ trans_id lst
°
¹Z
Ü	zsuc ¦ trans_id suc
°
¹Z
Ü	zpred ¦ trans_id pred
°
¹Z
Ü	zpos ¦ trans_id pos
°
¹Z
Ü	zval ¦ trans_id val
°
¹Z
Ü	zlength ¦ trans_id length
°
¹Z
Ü	zrange ¦ trans_id range
°

¹Z
Ü	fun 3	_ ^ _
°

¹ZAX
Ü	_ ^ _ : (Z_ID ¸ Z_ID) ­ Z_ID
°

=SML
val ^^ : (Z_ID * Z_ID) -> Z_ID
=TEX

\subsection{Translating Aggregates (Positional Array)}
=DOC
val Ûexp_array_agg_posÝ : CN_ENV -> EXP AGG_POS -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Positional Array with Others)}
=DOC
val Ûexp_array_agg_pos_othersÝ : CN_ENV -> EXP AGG_POS_OTHERS -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Positional Array with Just Others)}
=DOC
val Ûexp_array_agg_othersÝ : CN_ENV -> EXP AGG_OTHERS -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Named Array)}
=DOC
val Ûexp_array_agg_namedÝ : CN_ENV -> (AGG_CHOICE, EXP) AGG_NAMED -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Named Array with Others)}
=DOC
val Ûexp_array_agg_named_othersÝ : CN_ENV -> (AGG_CHOICE, EXP) AGG_NAMED_OTHERS -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Positional Record)}
=DOC
val Ûexp_rec_agg_posÝ : CN_ENV -> EXP AGG_POS -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Aggregates (Named Record)}
=DOC
val Ûexp_rec_agg_namedÝ : CN_ENV -> (AGG_CHOICE, EXP) REC_AGG_NAMED -> Z_EXP
=FAILURE
=ENDDOC
\subsection{Translating Unary Expressions}
=DOC
val Ûexp_unary_expÝ : CN_ENV -> EXP UNARY_EXP -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Binary Expressions}
=DOC
val Ûexp_bin_expÝ : CN_ENV -> EXP BIN_EXP -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Membership of a Range}
=DOC
val Ûexp_mem_rangeÝ : CN_ENV -> EXP MEM_RANGE -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Attributes}
=DOC
val Ûexp_attribÝ : CN_ENV -> (EXP, ATTRIB_DESIG) ATTRIBUTE -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Indexed Components}
=DOC
val Ûexp_indexed_compÝ : CN_ENV -> EXP INDEXED_COMP -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Selected Components}
=DOC
val Ûexp_selected_compÝ : CN_ENV -> EXP SELECTED_COMP -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Functions Calls}
=DOC
val Ûexp_fun_callÝ : CN_ENV -> EXP FUN_CALL -> Z_EXP
=FAILURE
=ENDDOC

\subsection{Translating Integer Literals}
=DOC

val Ûexp_int_litÝ : INT_LIT -> Z_EXP
=DESCRIBE
=FAILURE
=ENDDOC
\subsection{Translating Auxiliary Expressions}
=DOC
val Ûexp_auxiliary_expÝ : Z_EXP -> Z_EXP
=FAILURE
=ENDDOC

\subsection{The Function $trans\_exp$}
¹ZAX
Ü	trans_exp : EXP -> Z_EXP
°

=DOC
val Ûtrans_expÝ : CN_ENV -> EXP -> Z_EXP
=FAILURE
=ENDDOC

\section{TRANSLATING SPARK BASIC DECLARATIONS}

ÿBasic_Decl_Parsüüüüüüüüüüüüüüüüü
Ü	basic_decl : BASIC_DECL;
Ü	z : seq Z_PARA
ˆüüüüüüüüüüüüüüüüüüüü

\subsection{Translating Constants}

ÿBasic_Decl_Constüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Const_Decl ·
Ü	basic_decl = const_decl (Ê Const_Decl) ±
Ü	z = §z_eq_eq(trans_id const, trans_exp expr)¢
ˆüüüüüüüüüüüüüüüüüüüü

=DOC
val Ûbasic_decl_constÝ : CN_ENV -> EXP CONST_DECL -> PARAINFO list
=FAILURE
=ENDDOC

\subsection{Translating Enumeration Types}

¹ZAX
Ü	enum_attrib : (Z_ID ¸ Z_ID ¸ Z_ID) ­ seq Z_PARA
÷üüüüüüüüüüüüü
Ü µ zid‰1, zid‰2, zid‰3 : Z_ID ·
Ü ¶ zexp : Z_EXP ·
Ü	zexp = z_set_minus(zid zid‰1, z_set {zid (zid‰1 ^ zlst)}) ±
Ü	enum_attrib (zid‰1, zid‰2, zid‰3) =
Ü		§z_eq_eq(zid‰1 ^ zfst, zid zid‰2),
Ü		z_eq_eq(zid‰1 ^ zlst, zid zid‰3),
Ü		z_eq_eq(zid‰1 ^ zsuc, z_dom_res(zexp, zsucc)),
Ü		z_eq_eq(zid‰1 ^ zpred, z_inv(zid (zid‰1 ^ zsuc))),
Ü		z_eq_eq(zid‰1 ^ zpos, z_id_rel (zid zid‰1)),
Ü		z_eq_eq(zid‰1 ^ zval, z_inv(zid(zid‰1 ^ zpos)))
°

[X,Y]œœœœœœœœœœœœœœ
Ü	map : (X ­ Y) ­ seq X ­ seq Y
÷üüüüüüüüüüüüü
Ü µ f : X ­ Y; s : seq X ·
Ü	map f s = {i : ú; x : X | (i, x)  s · (i, f x)}
ˆüüüüüüüüüüüüüüüüü

This function already exists in {\Product} and is called $map$.

ÿBasic_Decl_Enumüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Type_Decl; Enum_Type_Def; zname : Z_ID;
Ü   zvals : seq Z_ID ·
Ü	basic_decl = type_decl (Ê Type_Decl) ±
Ü	type_def = enum_type_def (Ê Enum_Type_Def) ±
Ü	zname = trans_id name ± zvals = map trans_id vals ±
Ü	z =
Ü	{ i : dom vals · i í z_eq_eq(zvals i, z_num(i-1))} ^
Ü		§z_eq_eq(zname, z_rng(zid(head zvals), zid(last zvals)))¢ ^
Ü		enum_attrib(zname, head zvals, last zvals)
ˆüüüüüüüüüüüüüüüüüüüü

=DOC
val Ûbasic_decl_enumÝ : CN_ENV -> ID -> ENUM_TYPE_DEF -> PARAINFO list
=FAILURE
=ENDDOC
\subsection{Translating Array Types}

¹ZAX
Ü	array_attrib : (Z_ID ¸ Z_ID) ­ seq Z_PARA
÷üüüüüüüüüüüüü
Ü µ zid‰1, zid‰2 : Z_ID ·
Ü	array_attrib (zid‰1, zid‰2) =
Ü		§z_eq_eq(zid‰1 ^ zfst, zid (zid‰2 ^ zfst)),
Ü		z_eq_eq(zid‰1 ^ zlst, zid (zid‰2 ^ zlst)),
Ü		z_eq_eq(zid‰1 ^ zlength, z_size (zid zid‰2)),
Ü		z_eq_eq(zid‰1 ^ zrange, zid zid‰2)¢
°

ÿBasic_Decl_Array_Parsüüüüüüüüüüüüüüüüü
Ü	Type_Decl;
Ü	Array_Def;
Ü	zname, zindex, zcomp : Z_ID
÷üüüüüüüüüüüüü
Ü	zname = trans_id name;
Ü	zindex = trans_id index;
Ü	zcomp = trans_id comp
ˆüüüüüüüüüüüüüüüüüüüü


ÿBasic_Decl_Con_Arrayüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Basic_Decl_Array_Pars ·
Ü	basic_decl = type_decl (Ê Type_Decl) ±
Ü	type_def = con_array_def (Ê Array_Def) ±
Ü	z =
Ü	§z_eq_eq (zname, z_tfun(zid zindex, zid zcomp))¢ ^
Ü		array_attrib(zname, zindex)
ˆüüüüüüüüüüüüüüüüüüüü
=DOC
val Ûbasic_decl_con_arrayÝ : CN_ENV -> ID -> ARRAY_DEF -> PARAINFO list
=FAILURE
=ENDDOC


ÿBasic_Decl_Uncon_Arrayüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Basic_Decl_Array_Pars ·
Ü	basic_decl = type_decl (Ê Type_Decl) ±
Ü	type_def = uncon_array_def (Ê Array_Def) ±
Ü	z =
Ü	§z_eq_eq (zname, z_pfun(zid zindex, zid zcomp))¢
ˆüüüüüüüüüüüüüüüüüüüü
=DOC
val Ûbasic_decl_uncon_arrayÝ : CN_ENV -> ID -> ARRAY_DEF -> PARAINFO list
=FAILURE
=ENDDOC

\subsection{Translating Record Types}

¹ZAX
Ü	trans_decl : Var_Decl ­ Z_Decl
÷üüüüüüüüüüüüü
Ü µ Var_Decl; Z_Decl ·
Ü	trans_decl (Ê Var_Decl) = Ê Z_Decl ¤
Ü		zvar = trans_id var ± zexp = zid (trans_id tmark)
Ü		
°

ÿBasic_Decl_Recordüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü	¶ Type_Decl; rec : Record_Type_Def; Z_Schema ·
Ü	basic_decl = type_decl (Ê Type_Decl) ±
Ü	type_def = record_type_def rec ± z_sname = trans_id name ±
Ü	z_decls = trans_decl ¨ ran rec.decl © ±
Ü	z = §z_schema (Ê Z_Schema)¢
ˆüüüüüüüüüüüüüüüüüüüü
=DOC
val Ûbasic_decl_recordÝ : CN_ENV -> ID -> COMPONENT RECORD_TYPE_DEF -> PARAINFO list
=FAILURE
=ENDDOC

\subsection{Translating Integer Types}

¹ZAX
Ü	int_type_attrib : (Z_ID ¸ Range) ­ seq Z_PARA
÷üüüüüüüüüüüüü
Ü µ zid‰1 : Z_ID; Range ·
Ü	int_type_attrib (zid‰1, Ê Range) =
Ü		§z_eq_eq(zid‰1 ^ zfst, trans_exp lo),
Ü		z_eq_eq(zid‰1 ^ zlst, trans_exp hi)¢
°


ÿBasic_Decl_Int_Typeüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Type_Decl; Range; zname : Z_ID ·
Ü	basic_decl = type_decl (Ê Type_Decl) ±
Ü	type_def = int_type_def (Ê Range) ±
Ü	zname = trans_id name
Ü	z =
Ü	§z_eq_eq(zname, z_rng(trans_exp lo, trans_exp hi))¢ ^
Ü		int_type_attrib(zname, Ê Range)
ˆüüüüüüüüüüüüüüüüüüüü

=DOC
val Ûbasic_decl_int_typeÝ : CN_ENV -> ID -> EXP RANGE -> PARAINFO list
=FAILURE
=ENDDOC


\subsection{Translating Subtypes}

¹ZAX
Ü	range_con_attrib : (Z_ID ¸ Z_ID ¸ Range) ­ seq Z_PARA
÷üüüüüüüüüüüüü
Ü µ zid‰1, zid‰2 : Z_ID; Range ·
Ü ¶ zexp : Z_EXP ·
Ü	range_con_attrib (zid‰1, zid‰2, Ê Range) =
Ü		§z_eq_eq(zid‰1 ^ zfst, trans_exp lo),
Ü		z_eq_eq(zid‰1 ^ zlst, trans_exp hi),
Ü		z_eq_eq(zid‰1 ^ zsuc, zid(zid‰2 ^ zsuc)),
Ü		z_eq_eq(zid‰1 ^ zpred, zid(zid‰2 ^ zpred)),
Ü		z_eq_eq(zid‰1 ^ zpos, zid (zid‰2 ^ zpos)),
Ü		z_eq_eq(zid‰1 ^ zval, zid(zid‰2 ^ zval))
°

ÿBasic_Decl_Subtype_Range_Conüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Subtype_Decl; Range; zname, ztmark : Z_ID ·
Ü	basic_decl = subtype_decl (Ê Subtype_Decl) ±
Ü	con = range_con (Ê Range) ± zname = trans_id name ±
Ü	ztmark = trans_id tmark ±
Ü	z =
Ü	§z_eq_eq (zname, z_rng (trans_exp lo, trans_exp hi)) ¢ ^
Ü		range_con_attrib(zname, ztmark, Ê Range)
ˆüüüüüüüüüüüüüüüüüüüü
=DOC
val Ûbasic_decl_subtype_range_conÝ : CN_ENV -> ID -> TMARK -> EXP RANGE -> PARAINFO list
=FAILURE
=ENDDOC


ÿBasic_Decl_Subtype_Index_Conüüüüüüüüüüüüüüüüü
Ü	Basic_Decl_Pars
÷üüüüüüüüüüüüü
Ü ¶ Subtype_Decl; index : TMARK; Z_Decl;
Ü   zname, zindex : Z_ID; zp : Z_PRED ·
Ü	basic_decl = subtype_decl (Ê Subtype_Decl) ±
Ü	con = range_con (Ê Range) ± zname = trans_id name ±
Ü	ztmark = trans_id tmark ±
Ü	z =
Ü	§z_eq_eq (zname, z_rng (trans_exp lo, trans_exp hi)) ¢ ^
Ü		range_con_attrib(zname, ztmark, Ê Range)
ˆüüüüüüüüüüüüüüüüüüüü
=DOC
val Ûbasic_decl_subtype_index_conÝ : CN_ENV -> ID -> TMARK -> EXP list -> PARAINFO list
=FAILURE
=ENDDOC

\subsection{The Function $trans\_basic\_decl$}

¹Z
Ü µ Basic_Decl_Pars ·
Ü	trans_basic_decl basic_decl = z ¤
Ü		Basic_Decl_Const ² Basic_Decl_Enum ²
Ü		Baic_Decl_Int_Type ² Basic_Decl_Con_Array ²
Ü		Basic_Decl_Uncon_Array ² Basic_Decl_Record ²
Ü		Basic_Decl_Subtype_Range_Con ²
Ü		Basic_Decl_Subtype_Index_Con
°
=DOC
val Ûtrans_basic_declÝ : CN_ENV -> BASIC_DECL -> PARAINFO list
=FAILURE
=ENDDOC
\section{ADJUSTMENT OF ABSTRACT SYNTAX FOR EXPRESSIONS}
=DOC
val Ûadjust_expÝ : CN_ENV -> EXP -> EXP
=FAILURE
=ENDDOC

\section{EPILOGUE}

=SML
end (* local...in *);
end (* signature CNBasicDeclsAndExprs *);
=TEX





=TEX
\section{TEST POLICY}
The functions in this document are to be tested according to the
criteria identified in \cite{ISS/HAT/DAZ/PLN003}.

\small
\twocolumn[\section{INDEX}]
\printindex

\end{document}



