%  %Z%
=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999

\def\DRASpecs{\cite{DRA/CIS/CSE3/TR/94/27/2.1}}
\def\Volume#1{\cite[volume #1]{DRA/CIS/CSE3/TR/94/27/2.1}\/}
\def\VolumeOne{\Volume 1}
\def\VolumeTwo{\Volume 2}
\def\VolumeThree{\Volume 3}

\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DAZ PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Detailed Design: Theory Proof Support}  %% Mandatory field
\TPPref{ISS/HAT/DAZ/DTD509}  %% Mandatory field
\def\SCCSversion{$Revision$%
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}
%\TPPstatus{Approved}
\TPPstatus{Draft}
\TPPtype{Specification}
%\TPPkeywords{SPARK}
\TPPauthors{K.~Blackburn&WIN01}
%\TPPauthors{D.J.~King&WIN01\\R.D.~Arthan&WIN01}
\TPPauthorisation{R.D.~Arthan & DAZ Team}
\TPPabstract{
This is a structure containing methods of making the paragraphs generated by the compliance notation available to the user in a
normalised form.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
	A.~Smith, DRA \\
	Library}}
%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{daz,fmu}

\subsection{Changes History}  % to get section number `0.3'
\begin{description}
\item[Issue 1.1] Initial Drafts.
\end{description}
\subsection{Changes Forecast}
None.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document responds to the first recommendation of \cite{DS/FMU/DAZ/WRK509}.

\subsection{Introduction}

\subsubsection{Purpose and Background}

This document gives the detailed designs for tools that provide an easy user interface to the non-conjecture paragraphs generated by the  Compliance Notation Tool.

The tools take as input a list of axioms and definitions (or just extracts them from a nominated theory or theories) and saves theorems that are the best rewrite theorems that
can be derived using knowledge of Compliance Notation forms, as discussed in \cite{DS/FMU/DAZ/WRK509}.
The theorems should be saved in the current theory (the user may wish to use $new\_theory$ first).
It should also bind all the derived theorems to ML value names, and produce one or more
ML bindings of lists of theorems (most importantly, all generated theorems).

This will not expand out the definitions of any Compliance Notation constants, even those linked by apparently being generated from the same
basic declaration.

The new theorems should be sufficient that the original axioms and definitions need no longer be used 
(this ability to hide the original items is the only reason for processing axioms, as the
only relevant axioms are of the form $name : type$ which has little processing that
can be done).

\subsubsection{Dependencies}
???

\subsubsection{Possible Enhancements}
See \cite{DS/FMU/DAZ/WRK509}, for examples of what could be done if the requirement on not expanding the compliance notation constants was relaxed.

\section{DESIGN ISSUES}\label{DESIGNISSUES}
???

\section{THE STRUCTURE}

=IGN
\subsection{Preamble}

The following preamble creates the theory ``cn_theory_support'' as a child of ``z\_library''.

=IGN
open_theory"cn";
push_pc "z_library";
delete_theory"cn_theory_support" handle Fail _ => ();
val _ = set_flag ("z_type_check_only", false);
val _ = set_flag ("z_use_axioms", true);
new_theory"cn_theory_support";
=TEX
\section{THE STRUCTURE}\label{THESTRUCTURE}
\subsection{Preamble}
=DOC
signature ÛCNTheoryProofSupportÝ = sig
=DESCRIBE
This is the signature for the Theory Proof Support Tools.
=ENDDOC

=DOC
val Ûcn_support_theoryÝ : string -> unit;
val Ûlist_cn_support_theoryÝ : string list -> unit;
=DESCRIBE
$cn\_support\_theory$ takes a theory name as argument.
Assuming the theory is in scope it will examine each of the definitions and
axioms in the theory.

For definitions, if they are of the form:
=GFT
name == RHS
=TEX
they will be processed as below, and likewise if an axiom is of the form:
=GFT
name : TYPE
=TEX
or
=GFT
[ name ]
=TEX
they will be processed as below.
Otherwise, any other forms of definition or axiom will be ignored.

The processing will attempt to save theorems of the form:
=GFT
ô name = RHS'
ô name  TYPE'
ô name  U
=TEX
respectively, where $RHS'$, $TYPE'$ may be $RHS$ and $TYPE$ or may be simplified versions.
The simplifications will be by reasoning about constructs from $z\_library$ or its ancestors.

The theorems will be saved in the current theory under the name $cts\_name\_thm$,
and will also be bound to an ML variable of the same name.
If the theorem name is already in use then it is assumed to be for an earlier
use of the support tool, and the theorem will be replaced, and a warning issued.

Finally, a list of the theorems generated will be bound to the ML name $cts_theoryname\_thms$.

$list\_cn\_support_theory$ acts like $cn\_support\_theory$ mapped over a list of theory nmes, except that duplicate names in the list will be ignored.
=SEEALSO
$cn\_support\_thms$, 
$cn\_support\_thm$
=FAILURE
517001	Theorem ?0 in theory ?1 has been replaced by a new Compliance Notation support theorem
517002	Cannot force the saving of theorem ?0 in theory ?1
=ENDDOC

=DOC
val Ûcn_support_thmsÝ : THM list -> string -> unit;
=DESCRIBE
$cn\_support\_thms$ takes a list of theorems and analyses those that are Z paragraphs as if by $cn\_support\_theory$,
except that it binds the list of created theorems to the ML name that is the function's second argument, failing before saving any theorems if that is not a valid ML name.
=FAILURE
517001	Theorem ?0 in theory ?1 has been replaced by a new Compliance Notation support theorem
517002	Cannot force the saving of theorem ?0 in theory ?1
517003	?0 is not a valid ML variable name
=ENDDOC

=DOC
val Ûcn_support_thmÝ : THM -> string * THM;
=DESCRIBE
$cn\_support\_thm$ analyses its single theorem as if by $cn\_support\_theory$,
except that it does not save the resulting theorem, or bind it to an ML variable.
The function instead returns the name that $cn\_support\_theory$ would have used,
and the theorem it would have saved.
=FAILURE
517003	?0 is not capable of being supported by cn_support_thm
=ENDDOC

\subsection{Epilogue}
=SML
end (* end of signature CNTheoryProofSupport *);
=TEX
=SML
reset_flag ("z_type_check_only");
reset_flag ("z_use_axioms");
reset_flag("standard_z_paras");
=TEX


=TEX
\section{TEST POLICY}

The module tests for this module are to follow the guidelines
identified in the quality plan~\cite{ISS/HAT/DAZ/PLN003}.
There are no special testing considerations.

\small
\twocolumn[\section{INDEX}]
\printindex

\end{document}



