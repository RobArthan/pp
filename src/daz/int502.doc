% %Z% $Date$ $Revision$ $RCSfile$
=TEX
% The ML code in this document produces a number of theory listings in /tmp
% The following shell commands combine these into 1 file for inclusion
% in the printed document
% cat /tmp/INT502*.th.doc >int502.th.doc
% doctex int502.th
% rm /tmp/INT502*.th.doc

% TQtemplate.tex
% use_file "daz_init";
% use_file "int502";
% z_print_theory"-";
% open CNZGenerator;
% print_spark_program();
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{DAZ PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{VC Generation Examples}  %% Mandatory field
\def\TPPheadtitle{VC Generation Examples}
\TPPref{ISS/HAT/DAZ/INT502}  %% Mandatory field
\def\SCCSversion{$Revision$%
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}  %% Mandatory field (with sensible default)
\TPPstatus{Informal}
%\TPPstatus{Informal}
\TPPtype{Technical}
%\TPPkeywords{HOL}
\TPPauthor{R.D.~Arthan & HAT Team}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{D.J.~King & WIN01}
\TPPabstract{%
This document gives a Compliance Notation script intended to serve as a general test of the tool and to give raw material for testing the proof facilities.
}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
      Library}}

%\TPPclass{CLASSIFICATION}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\pagebreak
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,daz}

\subsection{Changes History}  % to get section number `0.3'
\begin{description}
\item[Issues 1.1-$Revision$%
] Initial Drafts.
\end{description}
\subsection{Changes Forecast}
None.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document contains test data for the Compliance Tool as specified in \cite{ISS/HAT/DAZ/HLD502} and \cite{ISS/HAT/DAZ/USR502}.
\subsection{Introduction}
For development of the proof facilities for the Compliance Tool it is convenient to have examples in mind.
This document presents the calculator example from ICL's earlier work on the SPARK Annotation Language (see \cite{DS/FMU/IED/ZED007}, provided to DRA as part of the proposal for the Compliance Notation work).
This example may be of interest to DRA.


\section{THE PACKAGE SPECIFICATION}
\subsection{Preamble}
=IGN
force_delete_theory"int502" handle _ => ();
force_delete_theory"CALCULATOR_TYPES" handle _ => ();
=SML
set_flag("z_type_check_only", false);
new_script"int502";
=TEX
\section{PACKAGE SPECIFICATIONS}
\subsection{Package $CALCULATOR\_TYPES$}

¹CN
package CALCULATOR_TYPES is

	type OP is (ADD, MULT, GO);
 
end CALCULATOR_TYPES;
°
\subsection{Z Specification of the State}
¹CN
with CALCULATOR_TYPES;
package DUMMY is
	 UNUSED : constant INTEGER := 0;
end DUMMY;
°

ÿ ÛCalculatorStateÝüüüüüüüüüüü
Ü	DISPLAY : ú;
Ü	ACCUMULATOR : ú;
Ü	LAST_OP : CALCULATOR_TYPESoOP;
Ü	IN_NUMBER : BOOLEAN
ˆüüüüüüüüüüüüüü
¹Z
Ü CalculatorState‰0 ¦	CalculatorState [
Ü					ACCUMULATOR‰0	/	ACCUMULATOR,
Ü					DISPLAY‰0	/	DISPLAY,
Ü					LAST_OP‰0	/	LAST_OP,
Ü					IN_NUMBER‰0	/	IN_NUMBER
Ü			 	]
°

\subsection{Z Specification of the Operations}
\subsubsection{Initialisation}
ÿ ÛInitPostÝ üüüüüüüüüüü
Ü CalculatorState
÷üüüüüü
Ü 	DISPLAY = 0;
Ü	ACCUMULATOR = 0;
Ü	LAST_OP = CALCULATOR_TYPESoGO;
Ü	IN_NUMBER = FALSE
ˆüüüüüüüüüüüüüü


\subsubsection{Digit Press}
ÿ ÛDigitPreÝ üüüüüüüüüüü
Ü	DIG : 0 .. 9
ˆüüüüüüüüüüüüüü
ÿ ÛDigitPostÝ üüüüüüüüüüü
Ü	IN_NUMBER‰0, IN_NUMBER : ú;
Ü	DISPLAY : ú;
Ü	DIG : ú
÷üüüüüü
Ü	IN_NUMBER‰0 = TRUE ´ DISPLAY = 10*DISPLAY + DIG;
Ü	IN_NUMBER‰0 = FALSE ´ DISPLAY = DIG;
Ü	IN_NUMBER = TRUE
ˆüüüüüüüüüüüüüü

\subsubsection{Digit Press}
ÿ ÛOpKeyPostÝ üüüüüüüüüüü
Ü	CalculatorState‰0;
Ü	CalculatorState;
Ü	KEY : CALCULATOR_TYPESoOP
÷üüüüüü
Ü	DISPLAY = ACCUMULATOR;
Ü	LAST_OP‰0 = CALCULATOR_TYPESoGO
Ü				´ ACCUMULATOR = DISPLAY‰0;
Ü	LAST_OP‰0 = CALCULATOR_TYPESoADD
Ü				´ ACCUMULATOR = ACCUMULATOR‰0 + DISPLAY‰0;
Ü	LAST_OP‰0 = CALCULATOR_TYPESoMULT
Ü				´ ACCUMULATOR = ACCUMULATOR‰0 * DISPLAY‰0;
Ü	LAST_OP = KEY;
Ü	IN_NUMBER = FALSE
ˆüüüüüüüüüüüüüü

\subsection{Package $CALCULATOR$}
¹CN
with CALCULATOR_TYPES;
package CALCULATOR is

	ACCUMULATOR, DISPLAY : INTEGER;
	LAST_OP : OP;
	IN_NUMBER : BOOLEAN;

	procedure INIT
		„ ACCUMULATOR, DISPLAY, LAST_OP, IN_NUMBER
			[ InitPost ];

	procedure DIGIT(DIG : IN INTEGER)
		„ DISPLAY, LAST_OP, IN_NUMBER
			[ DigitPre, DigitPost ];
	procedure OP_KEY
		„ ACCUMULATOR, DISPLAY, LAST_OP, IN_NUMBER
			[ OpKeyPre, OpKeyPost ];
end CALCULATOR;
°
\section{PACKAGE IMPLEMENTATION}
\subsection{Package $CALCULATOR$}
¹CN
with CALCULATOR_TYPES;
package body CALCULATOR is

	ACCUMULATOR, DISPLAY : INTEGER;
	LAST_OP : OP;
	IN_NUMBER : BOOLEAN;

	procedure INIT
	is
	begin
		„ ACCUMULATOR, DISPLAY, LAST_OP, IN_NUMBER
			[ InitPost ]					(10)
	end INIT;

	procedure DIGIT(DIG : IN INTEGER)
	is
	begin
		„ DISPLAY, LAST_OP, IN_NUMBER
			[ DigitPre, DigitPost ]			(20)
	end DIGIT;

	procedure OP_KEY(KEY : IN CALCULATOR_TYPES.OP
	is
	begin
		„ ACCUMULATOR, DISPLAY, LAST_OP, IN_NUMBER
			[ OpKeyPre, OpKeyPost ]			(30)
	end OP_KEY;
end CALCULATOR;
°
\pagebreak
\section{THEORY LISTINGS}
The following ML code causes the theory listings to be dumped into files which are subsequently included in this document.
=SML
val thynames = rev (get_children "daz_toolkit_extensions");
val chars = map (fn i => chr(i + ord "A" - 1)) (interval 1 (length thynames));

map (fn (char, thy) => (
		open_theory thy;
		z_output_theory {
			theory=thy,
			out_file = "/tmp/INT502"^char^ thy^".th.doc"}))
	((combine chars thynames));
=TEX
\pagebreak
%\HOLindexOff
\let\oldsection=\section
\let\oldsubsection=\subsection
\def\section{\pagebreak\oldsubsection}
\def\subsection{\subsubsection}
% cat /tmp/INT502*.th.doc >int502.th.doc
% doctex int502.th
% rm /tmp/INT502*.th.doc
\input{int502.th.tex}
%\HOLindexOn
%\twocolumn[\section{INDEX OF DEFINED TERMS}]
%\printindex
\end{document}
=IGN
