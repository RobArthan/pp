=TEX
% TQtemplate.tex
% rash -W 6in -e usr501A.rs >usr501A.ps
% rash -W 6in -e usr501B.rs >usr501B.ps
% rash -W 6in -e usr501C.rs >usr501C.ps
% rash -W 6in -e usr501D.rs >usr501D.ps
% sed -n '/^=DOC/,/^=ENDDOC/p' <dtd516.doc | sieve tex > usr501E.tex
\documentstyle[hol1,11pt,TQ,epsf]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Note#1{{\small\bf[ #1 ]}}
\makeindex
\TPPproject{DAZ PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Using the Compliance Tool}  %% Mandatory field
\TPPref{ISS/HAT/DAZ/USR501}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}
\TPPstatus{Approved}			%% Mandatory field
\TPPtype{Specification}
\TPPkeywords{Compliance Notation}
\TPPauthor{R.D.~Arthan & WIN01}  %% Mandatory field
\TPPauthorisation{D.J.~King & Project Manager}
\TPPabstract{
This document is the User Guide for the Compliance Tool
being produced for DRA under the DAZ project.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
\begin{tabular}[t]{lr}
C.O'Halloran & DRA\\
DAZ Project Library & WIN01\\
\end{tabular}}}

%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}
\newfont{\icllogo}{icllogo50}
\def\TPPheadlhs{$\vcenter{\halign{##\cr\icllogo ICL\cr}}$}
%\def\TPPheadcentre{}
%\def\TPPheadcentreproject{}
%\def\TPPheadrhs{}
\let\TPPfootlhs=\TPPfootrhs
\def\TPPfootcentre{$\vcenter{\halign{\hfil\strut##\hfil\cr
COPYRIGHT  \copyright\ ICL 1994\cr}}$}


\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\pagebreak
\listoffigures
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu,daz}

\subsection{Changes History}
\begin{description}
\item[Issue 2.1 (\FormatDate{94/03/11})] First approved issue.
\item[Issue 3.1 (\FormatDate{94/11/18})] Second approved issue.
\end{description}
\subsection{Changes Forecast}
The current version of this document is the second preliminary version for comment by DRA.
It will continue to be updated to become a full user guide for the Compliance Tool during completion of the design and implementation.

\pagebreak
\section{GENERAL}
\subsection{Scope}
This document is (a preliminary version of) the User Guide for the Compliance Tool.
It forms part of the response to the requirements for user documentation in \cite{ISS/HAT/DAZ/DEF501}.

\subsection{Introduction}
Sections \ref{INTRODOC} to \ref{COMMANDREF} of this document constitute the User Guide for the Compliance Tool.
In the present preliminary version, these are intended to indicate the overall structure of the User Guide and to approximate the finished document except where otherwise noted.




\Note{Notes such as this one are used for comments about the likely content of the final User Guide. These notes will subsequently be removed.}

\section{INTRODUCTION TO THIS USER GUIDE}\label{INTRODOC}

\subsection{Area Covered}

Once the Compliance Tool is installed on the user's workstation, by following the procedure described in the Installation Guide, this User Guide should enable the user to undertake the following tasks:

\begin{enumerate}
\item
Loading a Compliance Notation script into the tool.
\item
Generation of the SPARK program from a script;
\item
Generation of the Z document from a script;
\item
Using the VC Browser to examine the VCs and the Compliance Notation constructs which gave rise to them.
\item
Editing and checking of a script;
\end{enumerate}

\subsection{Assumptions}

This User Guide is {\em not} intended to be an introduction to the Z language, or to the Compliance Notation, or to the use of {\Product} to prepare the Z parts of a script.

A tool-independent description of the Compliance Notation is given in \cite{DRA/CIS/CSE3/SWI/n/1}.
The {\ProductZ} tutorial, \cite{DS/FMU/IED/USR010}, gives an introduction to the use of {\Product} for specification and proof in Z.

The {\Product} user documentation is supplied as part of the {\Product} release  included with the Compliance Tool and is available for on-line reference.

The user interface to the tool described in this document is a Motif application  running under the X Windows System.
Users who are unfamiliar with X or Motif should consult local or supplier's documentation or expertise for further guidance (e.g. see \cite{sun92a}).


\pagebreak
\section{INTRODUCTION TO THE COMPLIANCE TOOL}\label{INTROTOOL}
\subsection{The Compliance Notation}
The Compliance Tool supports a notation for demonstrating the compliance of Ada programs with Z specifications.
The Ada parts of the notation belong to the SPARK subset of Ada and will be referred to as SPARK in the rest of this document.
The Compliance Notation was designed by the Defence Research Agency, Malvern and is described in the DRA document \cite{DRA/CIS/CSE3/SWI/n/1}.

Compliance Notation is prepared and presented in literate scripts containing a mixture of narrative text, Z and SPARK.
Special constructs are provided for two main purposes:

\begin{enumerate}
\item
to allow the SPARK program to be presented and documented in an order independent of that prescribed by the SPARK syntax (in a similar fashion to Knuth's Web system \cite{Knuth84a});
\item
to allow the behaviour of the SPARK code to be formally specified in Z (using a style based on Morgan's refinement calculus \cite{Morgan90}).
\end{enumerate}

These constructs allow the user to assert formal connections between the Z parts and the SPARK parts in a Compliance Notation script and permit the compliance of the SPARK program against its Z specifications to be reduced to a set of conjectures known as verification conditions, whose truth guarantees compliance.
The VC generation algorithm is formally specified in the DRA technical report \cite{DRA/CIS/CSE3/TR/94/27/1.0}.
The algorithm maps a Compliance Notation script to a Z document containing the VCs formulated with Z conjectures together with supporting Z definitions.

\subsection{The Compliance Tool}
The Compliance Tool described in this document supports the use of the Compliance Notation.
It performs the following principal functions:

\begin{enumerate}
\item
Checking the syntax of a Compliance Notation script;
\item
Generating the Z document including VCs from a script;
\item
Extracting the SPARK program from a script.
\end{enumerate}

The Compliance Tool is implemented as an application of the {\Product} specification and proof tool.
The tool provides all the facilities offered by {\Product} for developing specifications and proofs in HOL and Z and for preparing high quality printed output via the {\LaTeX} system.
The tool includes some custom facilities for working with Compliance Notation including a VC browser and some customised proof procedures.



\pagebreak
\section{GETTING STARTED}

The task of using of the Compliance Tool to process a script is very similar to that of using {\Product} to process a Z specification.
Indeed, the Z paragraphs in a Compliance Notation script are handled using the usual {\Product} mechanisms and the constructs peculiar to the Compliance Notation are treated in a very similar way.

Simple use of the tool to process existing scripts does not require any great familiarity with {\Product}.
Using the tool to create new scripts or edit existing ones requires some familiarity with the preparation of Z specifications using {\Product} (as described in \cite{DS/FMU/IED/USR011}).
Sections \ref{Databases} and \ref{StartingXpp} below explain how to start an interactive session with the tool for either of these levels of use.
Section \ref{WindowLayout} gives a brief overview of the main graphical features of the tool.

\subsection{{\Product} Databases}\label{Databases}
As always with a {\Product} application, to use the Compliance Tool you must first pick the {\Product} database with which you wish to work.
A {\Product} database is a file which holds code and data recording the results of work with {\Product}.
These databases are organised in a hierarchy.
To run the Compliance Tool, you use a database which is a descendant in this hierarchy of the database {\tt pp\_daz}.
This database, held in a file called
{\tt sun4bin/sun4pp\_daz.db} in the {\Product} installation directory, contains the code and data required to process Compliance Notation.
If you are starting from scratch, you would create a suitable database, say called {\tt mydatabase}, using a UNIX command line such as:

\begin{verbatim}
        pp_make_database -p pp_daz mydatabase
\end{verbatim}

This creates an empty database, which you will generally refer to as `{\tt myapp}' when using the system.
The database is held in a file called `{\tt sun4myapp.db}' and this is the name you would use to carry out UNIX file operations on the database, e.g., to delete it with the UNIX command `{\tt rm}'.

\subsection{Starting {\tt xpp}}\label{StartingXpp}
To start an interactive session with the Compliance Notation tool, you use the UNIX command {\tt xpp}.
{\tt xpp} comprises a custom editor for working on your scripts together with a command interface for executing {\Product} commands and for loading Z and Compliance Notation constructs into the database.

The {\tt xpp} command has options to identify the file containing the script you want edit and to give the {\Product} command options (including the database to use).
To begin work on the script `{\tt wrk001.doc}' with the database `{\tt mydatabase}', you might use the UNIX command line:

\begin{verbatim}
        xpp -file wrk001.doc -command pp -d mydatabase
\end{verbatim}
 

This will create a Motif window similar to the one shown in figure \ref{fig1}.
This is referred to as the {\tt xpp} Main Window.
If you omit the {\tt -command} option, then you will get a so-called edit-only session, in which the lower part of the window will be missing.

\subsection{Window Layout}\label{WindowLayout}
This section describes briefly the main elements of the {\tt xpp} Main Window.
Further information may be obtained either from the tool's help system or from the {\Product} documentation.

In overview, the top part of the window acts as an editor for literate scripts.
Material from the editor can be transferred into the {\ProductML} system for processing (e.g. to type check a specification paragraph or initiate a proof step).
The journal of the transactions with {\Product} occupies the bottom part of the window.
Figure \ref{fig1} also shows a popup window (in this case a palette of special symbols).
The size and position of all the windows can be adjusted using standard Motif techniques.

Sections \ref{MenuBar} to \ref{JournalWindow} below describe the principal features of the {\tt xpp} Main Window.

\subsubsection{Menu Bar}\label{MenuBar}
The menu bar is at the top of the window shown in figure \ref{fig1}.
The menus are all pulldown menus operated in the usual Motif fashion.
The functions they perform are briefly described below.

\paragraph{File Menu}
This menu is for common file operations including: loading and saving the literate script; creating a new literate script; deleting a file.

\paragraph{Tools Menu}
This menu is used to create popup windows to perform various tasks.
An example is the palette window shown in figure \ref{fig1}.

\paragraph{Edit Menu}
This menu provides script editing operations: `Cut', `Copy', `Paste' and `Undo'.
\paragraph{Command Menu}\label{CommandMenu}

This menu is primarily used to cause text from the script window to be executed by the {\ProductML} system.
It also provides various control functions for the {\ProductML} system.

\paragraph{Help Menu}\label{HelpMenu}
This menu provides help on various topics.
Its `Tutorial' item may be consulted for more information on basic operation of {\tt xpp}.

\subsubsection{File Name Bar}\label{FileNameBar}
This displays the name of the file containing the script which is being edited in the Script Window.

\subsubsection{Script Window}\label{ScriptWindow}
The Script Window is the upper large Motif text window in the {\tt xpp} Main Window.
It provides a general purpose editor for viewing and modifying scripts.
In  figure \ref{fig1} on page \pageref{fig1}, a Compliance Notation script containing definitions of a a Z global variable, `$primed$', and a SPARK procedure, `$primes$', is being displayed in the Script Window.

Part of the Script Window in figure \ref{fig1} is hidden behind a window containing a `palette' of symbols.
This palette has been selected from the Tools Menu and can be used to enter the symbols into the literate script.
Pushing one of the buttons on the palette causes the symbol to appear in the document as if it had been typed at  the keyboard.

Note that the Z and SPARK constructs in the Script Window are delimited using special mark-up sequences:
{\ShowAllImages `$¹Z$'', `$¹CN$' and `°'}.
A tool called the Templates Tool is available from the Tools Menu allowing easy entry of these mark-up sequences.

\subsubsection{Journal Window}\label{JournalWindow}
The Journal Window is the lower large Motif text window in the {\tt xpp} Main Window.
When {\Product} commands are executed the resulting responses from the {\Product} system are displayed in the Journal Window.
The Journal Window is a read-only text window --- you cannot alter its contents by typing into it.

In \ref{fig1}, the user has just issued a command to process the procedure $primes$.
This is done by selecting the procedure and its delimiting mark-up sequences in the Script Window and then using the `Execute' item in the Command Menu.
The absence of error messages in the Journal Window and the prompt (`$:>$') indicate that the procedure has been processed and accepted.

\begin{figure}[p]
\begin{center}
\leavevmode
% rash -W 6in -e usr501A.rs >usr501A.ps
\epsffile{usr501A.ps}
\end{center}
\caption{An Example Compliance Tool Session}\label{fig1}
\end{figure}



\pagebreak
\section{COMPLIANCE NOTATION FUNCTIONS}
Sections \ref{Loading} to \ref{Editing} below describe basic use of the main functions of the Compliance Notation tool.

You invoke many of these functions by executing {\ProductML} commands.
This may conveniently be done interactively using the Command Line Tool which can be started using the Tools Menu.
An instance of the Command Line Tool may be seen in figure \ref{fig2} on page \pageref{fig2}.
This tool allows single line {\ProductML} commands to be entered and executed without changing the script which is being edited.
The tool also has a scrollable list which you can use as a memory for common commands.

\subsection{Loading a Script}\label{Loading}
\Note{This section will describe the use of the `{\tt docsml}' and `$use\_file$' to load an existing (correct) script}.

\subsection{Generating the SPARK Program}\label{SPARKProgram}
\Note{This section will describe the use of `$output\_spark\_program$' and `$print\_spark\_program$' to produce the SPARK program}.
\subsection{Generating the Z document}\label{ZDocument}
\Note{This section will describe the use of `$output\_z\_document$' and `$print\_z\_document$' to produce the Z document}.
\subsection{Using the VC Browser}\label{VCBrowser}
Figure \ref{fig2} on page \pageref{fig2} gives another example of an {\tt xpp} Main Window.
In this example, the user has used the Command Line Tool to issue commands to load an entire script into the tool and then display the Z document in the Journal Window.
The Search-and-Replace Tool has been used to carry out a textual search in the Script Window for the refinement step which introduced the VC at the end of the Z document.

Using an editor to correlate the script with the VCs can be a useful technique but is often time consuming.
The VC Browser gives an easy way of examining the VCs and relating them to the Compliance Notation clauses which produced them.
The VC Browser is started by running the {\ProductML} command `$browse\_vcs()$'.
This produces a window like the one shown in figure \ref{fig3} on page \pageref{fig3}.


The main controls in the VC Browser are two scrolling lists of names and some push-buttons.
Above each list is a text area.

The list on the left contains the names of the clauses in the script;
the list on the right the names of the VCs.
Double-click on an item in either list to display the clause or VC in the text area above the list.

The buttons marked `Filter' are used to find the clause corresponding to a selected VC and the VCs corresponding to a selected clause.
After you have used one of the `Filter' buttons, you can use the corresponding `Reset' button to restore the contents of the list.

In figure \ref{fig3}, the user has double clicked on the label `$5$' in order to see the corresponding refinement step.
Pressing the right-hand filter button has then resulted in the corresponding VC  being listed and displayed on the right (in this case there is only one VC).

\begin{figure}[p]
\begin{center}
\leavevmode
\epsffile{usr501B.ps}
\end{center}
\caption{Inspecting VCs with {\tt xpp}}\label{fig2}
\end{figure}

\begin{figure}[p]
\begin{center}
\leavevmode
\epsffile{usr501C.ps}
\end{center}
\caption{Inspecting VCs with the VC Browser}\label{fig3}
\end{figure}

\subsection{Editing a Script}\label{Editing}

The {\tt xpp} Script Window provides a general purpose editor for use in preparing scripts.
The {\Product} document \cite{DS/FMU/IED/USR004} or the {\tt xpp} help system may be consulted for an introduction to its use.

To make entry of Compliance Notation constructs easier, the Templates Tool in {\tt xpp} has been customised so that you can enter a template for any of the following constructs with one button-press:

\begin{enumerate}
\item
Replacement Step;
\item
Refinement Step;
\item
Compilation Unit;
\item
Specification Statement;
\item
Each of the 8 Z Paragraph forms.
\end{enumerate}

The customised Templates Tool may be seen in figure \ref{fig4} on page \pageref{fig4}.
The four buttons at the top are for the four Compliance Notation constructs listed above.
In the figure the user has just pressed the refinement step button and has started to fill in the template at the bottom of the Script Window --- the label has been filled in and the ellipsis, `\ldots', has been selected ready to be replaced by the statement part of the refinement.

\begin{figure}[p]
\begin{center}
\leavevmode
\epsffile{usr501D.ps}
\end{center}
\caption{Compliance Notation Templates Tool}\label{fig4}
\end{figure}


\pagebreak
\section{BATCH WORKING}
\Note{This section will describe the how to extract SPARK programs and Z documents from existing scripts via a single UNIX command line.}.


\pagebreak
\section{{\ProductML} COMMAND REFERENCE}\label{COMMANDREF}
The following boxes give reference documentation for the principal {\ProductML} commands which are specific to the Compliance Tool.
Consult the {\Product} reference manual for further information on {\ProductML} commands mentioned in this document which are not mentioned here.

\input{usr501E.tex}

\end{document}


