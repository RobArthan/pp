\documentstyle[TQ,hol]{article}
%\tracingonline=1\tracingmacros=2\tracingcommands=2
\makeindex
\def\SCCSversion{$Revision$
}
\setcounter{section}{-1}
\setcounter{tocdepth}{1}
\setcounter{secnumdepth}{4}
\def\etc{{\it etc.\ }}
\def\eg{{\it e.g.}}
\def\Eg{{\it E.g.}}
\def\ie{{\it i.e.}}
\def\Ie{{\it I.e.}}
\begin{document}
\TPPproject{IED 1563}
\TPPtitle{Typesetting HOL and Z with \LaTeX}
\TPPref{DS/FMU/IED/USR001}
\TPPissue{\SCCSversion}
\TPPdate{19 December 1989}
\TPPstatus{Draft}
\TPPtype{User Documentation}
\TPPkeywords{HOL, \LaTeX, Z}
\TPPauthor{R.D.~Arthan&WIN01
}
\TPPauthorisation{R.B.~Jones&FMU Manager
}
\TPPabstract{
}
\TPPdistribution{\hspace{2in}\begin{tabular}{l}
Library\\
\end{tabular}
}
\makeTPPfrontpage
\vfill
\begin{centering}
\bf Copyright \copyright\ : International Computers Ltd \number\year
\end{centering}
\pagebreak
\section{Document Control}
\subsection{Contents List} \tableofcontents
\subsection{Document Cross References}
 
\bibliographystyle{fmu}
\bibliography{fmu}
\subsection{Changes History}
\begin{description}
\item[Issue 1.5 (31 Aug 1989)] This is the first draft
to be lodged in the project library. Earlier drafts have
been distributed as necessary to initial users of the
facilities described during their development.
\item[Issue \SCCSversion (\today)] {\tt pretty2tex} is now called
{\tt doc2tex}. The name {\tt pretty2tex} may currently still be used
but it is likely to be withdrawn eventually.
\end{description}
\subsection{Changes Forecast}
Any changes to the facilities described here will be
reflected in this document.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document describes some facilities for
using \LaTeX\ to prepare documents
containing Z or HOL or similar formal material.
The facilities are similar in spirit to those
described in \cite{DS/FMU/infra/006},
for preparing such documents using {\tt ptroff}.

\subsection{Introduction}
The package consists of a \LaTeX\ style file
(\ie, macro suite),
{\tt hol.sty}, a preprocessor program, {\tt doc2tex}
and a font {\tt newzfont}.

The preprocessor allows the user to prepare a \LaTeX\
file using the extended (`pretty')
character set described in \cite{DS/FMU/infra/006}.
Thus the formal material appears on the screen much
as it does in the printed document, while the format of
the file is compatible with the HOL  system ({\it via}
the interfaces described in \cite{DS/FMU/infra/006}).

The rest of this document describes the use of the
package, largely by example.
We assume some familiarity with \LaTeX, which is
described in \cite{lamport86} and with the HOL
infrastructure for supporting Z-like constructs
described in \cite{DS/FMU/infra/002}.

\section{Using the Package}

\subsection{Getting Started}
To use the package you prepare a file, say
{\tt myfile.doc}, using an editor which supports
an appropriate pretty font. (The font {\tt newzfont}
is recommended.)

The form of the file is essentially that of a
\LaTeX\ file except that you can use pretty
(\ie, non-ASCII) characters to type Z or HOL constructs.
The \verb"\documentstyle" command line that you use should
include the option {\tt hol}. \eg, in this document
I used:

\begin{verbatim}
\documentstyle[TQ,hol]{article}
\end{verbatim}

to get the options {\tt TQ} (which gives our house style)
and {\tt hol}.
The style file {\tt hol.sty} is in the directory {\tt /hat/loc/tex/macros}. The easiest way of ensuring that \LaTeX\ finds
the file is to include the line
\begin{verbatim}
setenv TEXINPUTS .:/hat/loc/tex/macros:/usr/lib/tex/macros:
\end{verbatim}

in your C-shell startup file ({\tt \verb"~"/.cshrc}).

To print the file you run the preprocessor with
a command like:

\begin{verbatim}
doc2tex <myfile.doc >myfile.tex
\end{verbatim}

and then run \LaTeX\ on {\tt myfile.tex} in the usual
way.
(The program {\tt doc2tex} is in the  directory {\tt /hat/loc/bin} and the above recipe assumes that you have
put that directory on your search path).

The basic job of {\tt doc2tex} is to translate each
non-ASCII character into \LaTeX\ macro calls which
typeset that character. Some non-ASCII characters
control the way in which {\tt doc2tex} does this,
as we shall see.

\subsection{\LaTeX\ Environments}

The {\tt hol} style option makes available
the \LaTeX\ environments listed in the following table.
Each environment corresponds to a Z or HOL box.
The environments are not normally to be invoked
by typing \verb"\begin{...}" and \verb"\end{...}".
Instead, you use the 
`opening' and `closing bracket'  characters listed in the table (see \ref{TheoryListings} below for an exception to this).

\def\Sh#1{\hbox to 1.5em{\vrule
  width 0pt height 1.5\ht\strutbox depth 1.5\dp\strutbox
  \hfil#1\hfil}}
\begin{tabular}{|l|c|c|p{3in}|} \hline
Environment & Opening & Closing & Purpose \\ 
            & Bracket & Bracket & \\ \hline \hline
{\tt zschema}*& \Sh{\TopleftZ} & \Sh{\Bottomleft} &
Z schema definition \\
{\tt zgenconst}& \Sh{\Digamma} & \Sh{\Bottomleft} &
Z generic constant definition\\
{\tt zaxdes}& \Sh{\StartZaxdes} & \Sh{$\lfloor$} &
Z axiomatic description\\
{\tt zother}& \Sh{\StartZother} & \Sh{$\EndML$} &
Other Z paragraph forms: given type \etc \\
{\tt HOLaxdes}& \Sh{$\lceil$} & \Sh{$\lfloor$} &
HOL constant definition \\
{\tt HOLinfixaxdes}& \Sh{\Startinfixaxdes} & \Sh{$\lfloor$} &
HOL infix constant definition \\
{\tt HOLschema}*& \Sh{\Topleft} & \Sh{\Bottomleft} &
HOL schema definition \\
{\tt ML}& \Sh{\StartML} & \Sh{\EndML} &
ML code (\eg, a proof) \\
{\tt FT}*& \Sh{\StartFT} & \Sh{\EndML} &
Any other formal text to be typeset in a similar style to
Z or HOL (\eg, HOL output)\\ \hline
\end{tabular}

The environments marked with an asterisk (*) take
a parameter giving the name of the schema, the
parameters of the generic constant or the title
for the formal text.
These should be typed immediately after the `\Topleft'
character followed by optional padding (see below).
(Programs such as `{\tt prettyhol}' which process such
material may enforce extra rules. \Eg, the HOL
schema header must be terminated by a `\Topright' character.)

The shape of the bracketing characters has been chosen
so that you can use them, together with the pretty
characters `\Vbar', `\Hbar', `\Bottomright', `\Topright',
`\ParallelLines' and `\Bigturnstile', to draw boxes which look on the screen like
the printed form.
`\Vbar', `\Hbar', `\Bottomright', `\Topright'
and `\ParallelLines' are
merely padding and have no effect on the form of
printed document.
Within one of the three sorts of HOL box,
`\Bigturnstile' causes the bar between the
signature and predicate parts of 
the box to be printed. Only padding characters should
appear in the line after the `\Bigturnstile'.
(`\Bigturnstile' corresponds to a \LaTeX\ macro
\verb"\crossbar".)

Within any of the above environments, text is typeset
with each ``line of input'' corresponding to a line in the
printed document.
Here if one of the bracketing character pairs listed
above encloses the text ``line of input'' means
line of input; if you are
using \verb"\begin{...}" and \verb"\end{...}"
to delimit the environments, then  a ``line of input''
must have its beginning and end marked with
\verb"\\" and \verb"\+" respectively.
Tab and space characters may be used to control the layout.
 
\subsection{Quirks and Foibles}

The package is designed
on the assumption that text bracketed
with one of the
pretty character pairs listed above is actually
going to be processed by a program such
as {\tt prettyhol} ({\it via} 
interfaces like those
described in \cite{DS/FMU/infra/006}).
Consequently, it is assumed {\it (a)} that such text will
not contain any \LaTeX\ formatting controls apart from
spaces, tabs and newlines and {\it (b)} that any \LaTeX\
special characters such as `\$' and `\_' are not
to be treated specially and are just to be printed.


The package has also been designed on the assumption
that if you use \LaTeX\ \verb"\begin{...}" command
to invoke one of the above environments you are
doing it to use \LaTeX\ to get some special effect\footnote{
If you want to do this you will need to know that lines
of text in these environments are typeset in math mode,
adjusted so that all spacing (even around relation
symbols \etc) must be requested explicitly.
See the style file for details of how this is done.}
(see \ref{TheoryListings} below for an exception to this).
The package
therefore only serves to translate non-ASCII characters
in text which is not enclosed in a pair of
bracketing characters.
It does not put in controls
for extra spaces or for printing \LaTeX\ special characters,
on the assumption that you will want to set the
spacing yourself and to use the special characters
as special characters.


\subsection{Controlling the Layout}

The dimension registers \verb"\ftlmargin" and
\verb"\ftrmargin" may be used to adjust the additional
left and right margin space used for the boxes. These
are set to give no additional space by default.

The count register \verb"\ftlinepenalty" sets
the penalty which applies at the end of each line
of formal text in the various Z and HOL environments.
It is set to $10000$ by default.
This means value means that no pagebreaks will be
allowed within such an environment. If you want
to allow pagebreaks use \eg, \verb"\ftlinepenalty=0".

\subsection{Making an Index}

An additional pair of pretty characters, `\Startindex' and
`\Endindex' may be used to help make an index for the
document.
If you type, say, `\Startindex\verb"InterestingThing"\Endindex', somewhere in {\tt myfile.doc} then
‚InterestingThing·
will be printed in bold and the \LaTeX\ macro
\verb"\index" will be  called with `InterestingThing'
as parameter.
If, following the instructions in \cite{lamport86},
you have used \verb"\makeindex" earlier in your
document this will cause an entry of the form:

\begin{verbatim}
\indexentry{InterestingThing}
\end{verbatim}

to be written in the file {\tt myfile.idx}.

A macro \verb"\printindex" is supplied in the {\tt hol}
style option for
including the index in the printed document.
To use it type \verb"\printindex" in your
file where you want the index to appear.

You will usually want to do some form
of manipulation of the file {\tt myfile.idx}, such
as sorting it, before including it in the document.
The package adopts the convention that, in this example,
{\tt myfile.sid} is the name of the file holding
the sorted, or otherwise adjusted, index.
\verb"\printindex" reads this file in an
environment in which each \verb"\indexentry"
produces entries whose form may be seen in the
index to this document. 

\subsection{Theory Listings} \label{TheoryListings}

To help you incorporate HOL theory listings and the
like, {\tt doc2tex} has a special way of working.
If the pretty form of the theory listing is held
in the file {\tt theory.lst}, you would use say

\begin{verbatim}
doc2tex -i <theory.lst >theory.inc
\end{verbatim}

which makes the file {\tt theory.inc} suitably
for including within an {\tt FT} environment
using the \LaTeX\ command \verb"\input".
You would use something like:

\begin{verbatim}
\ftlinepenalty=0
\begin{FT}{Theory Listing}
\input{theory.inc}
\end{FT}
\end{verbatim}

to include the listing in your document. Note that
you do not use `\StartFT' and `\EndML' to delimit
the environment here. Note also the adjustment
of \verb"\ftlinepenalty" to allow the listing
to spread over several pages.

\section{HOL Examples}

Here is an HOL schema:

«`‚STATE·``S`ﬂ
›	high : Ü, low : Ü
…
›	high à low
 ‡

% Macros for a tiny gap:
\def\Tg{\hskip 0.1em}

I typed the above approximately as follows:
{\tt
\begin{tabular}{l}
\Topleft\Tg`\Startindex STATE\Endindex` `S` \Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Topright\\
\Vbar\Tg\hskip 0.5in high : Ü, low : Ü\\
\Bigturnstile\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\\
\Vbar\Tg\hskip 0.5in high à low\\
\Bottomleft\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Hbar\Tg\Bottomright\\
\end{tabular}}

An example of the ML environment follows.
Note the font change for the HOL term. 

Â
›	new_theory`12`;;
›	new_parent`pf`;;
›	loadf`infra`;;
›	let  tm="án:Üé1 < n  Ä  n < 10";;
Ê

Terms may of course spread over many lines, as in:
Â
set_goal([],"É(in_f : INPUT_FILTER_TYPE)
		(out_m : OUTPUT_MERGER_TYPE)
		(prog : USER_PROGRAM_TYPE)é
		in_f  ù  input_filter_specification
	Ä	out_m  ù  output_merger_specification
	Ä	progùuser_program_specification
	ä	composite_construction(in_f,out_m,prog)
			ù  secure");;
Ê


The two sorts of constant definition:

»
›	‚secure· : SYSTEM_TYPEãbool
…
›	É(f:SYSTEM_TYPE)é
›	f  ù  secure Ç 
›	És∞ s¨:STATEé(s∞.S_low = s¨.S_low)  ä  ((f s∞).S_low = (f s¨).S_low )
À

Á
›	‚ƒ· : bool ã bool ã bool
…
›	A ƒ B  =  A Ä åB
À

\section{Z Examples}

We give an example of each sort of Z paragraph
(using the terminology of Spivey's book).
We start with a given type definition.


Ë
›	[‚NAME·, ‚DATE·]
Ê

I typed the above approximately as follows:
{\tt
\begin{tabular}{l}
\StartZother\\
\Vbar\hskip 0.5in[\Startindex NAME \Endindex,
\Startindex DATE \Endindex]\\
\EndML\\
\end{tabular}}

Now an axiomatic description box:

Í
	‚known·:ëNAME
	‚birthday·:NAMEñDATE
…
	known  =  dom birthday
À

Since `\Vbar' characters can be omitted,
I typed that as:
{\tt
\begin{tabular}{l}
\StartZaxdes\\
\hskip 0.5in\Startindex known\Endindex:ëNAME\\
\hskip 0.5in\Startindex birthday\Endindex:NAMEñDATE\\
\Bigturnstile\\
\hskip 0.5inknown = dom\Tg birthday\\
$\lfloor$\\
\end{tabular}}

Now a schema box:

È‚BirthdayBook1·
	names:Ü∞ãNAME
	dates:Ü∞ãDATE
	hwm:Ü
…
	Éi,j: 1 .. hwm é
		iàj ä names(i) à names(j)
 

The first line of that was typed as:
{\tt \Topleft\Startindex BirthdayBook1\Endindex}

A generic constant box, typed with
{\tt \Digamma[X]}

Î[X]¸¸¸¸¸¸¸¸¸
›	‚\#·:íX ãÜ
…ÕÕÕÕÕÕÕÕ
›	És:íXé
›		\#s=(án : Ü é Ñf:1 .. Ü   ê   Sétrue)
 

Like given type definitions,
the remaining three forms of paragraph (abbreviation
definition, free type definition and constraint)
are done with `\StartZother' and `\EndML':

Ë
	‚DATABASE·        ∂       ADDR ã PAGE

	‚TREE· ::= tip  |  forkæÜ â TREE â TREEø

	n_disks<5
Ê

\section{Miscellaneous}

The final sort of environment, {\tt FT}, may be used for HOL output
or anything similar. It is invoked with `\StartFT'
followed by a name to be used as a title,
and ended with `\EndML'.
 
ÛHOL output
OKéé
goal proved
éééé Ö in_f F s∞ = in_f F s¨
éé Ö in_f F s∞ = in_f F s¨

Previous subproof:
"(out_m cl(f(in_f cl s∞))s∞) . S_low =
 (out_m cl(f(in_f cl s¨))s¨) . S_low"
    [ "És∞ s¨é
        ((in_f F s∞) . S_high = (in_f F s¨) . S_high) Ä
        ((in_f F s∞) . S_low = s∞ . S_low)" ]
    [ "És∞ s¨é
        ((out_m T s∞ s¨) . S_low = s¨ . S_low) Ä
        ((out_m F s∞ s¨) . S_low = s∞ . S_low)" ]
    [ "s∞ . S_low = s¨ . S_low" ]
    [ "åcl" ]
    [ "in_f F s∞ = in_f F s¨" ]

Ê

As another example of the \verb"FT" environment
here are all the pretty characters (except those,
such as $\vert\sp{H}$, used for bracketing formal
text):
\tabstop=0.25in


Û Pretty Characters
	Ä	Å	Ç	É	Ñ	Ö	Ü	á
	à	â	ä	ã	å	ç	é	è
	ê	ë	í	ì	î	ï	ñ	ó
	ò	ô	ö	õ	ú	ù	û	ü
	†	°	¢	£	§	•	¶	ß
	®	©	™	´	¨	≠	Æ	Ø
	∞	±	≤	≥	¥	µ	∂	∑
	∏	π	∫	ª	º	Ω	æ	ø
	¿	¡	¬	√	ƒ	≈	∆
						Œ	œ
	–	—	“	”	‘	’	÷	◊
	ÿ	Ÿ	⁄	€	‹		ﬁ
					„	‰
					Ï	Ì	Ó	Ô
		Ò	Ú		Ù	ı	ˆ	˜
	¯	˘	˙	˚		˝	˛	ˇ
Ê




\section{Controlling the Layout}

The dimension registers \verb"\ftlmargin" and
\verb"\ftrmargin" may be used to adjust the additional
left and right margin space used for the boxes. These
are set to give no additional space by default.
If you use, for example,
\begin{verbatim}
\ftlmargin=1.5in \ftrmargin=1.5in
\end{verbatim}
you get the following:
\ftlmargin=1.5in \ftrmargin=1.5in
È‚BirthdayBook1·
	names : Ü∞ãNAME
	dates : Ü∞ãDATE
	hwm : Ü
…
	Éi,j: 1 .. hwm é
		iàjänames(i)ànames(j)
 
In all of the environments tab characters are
interpreted specially and give typewriter-style
tabstops at $1\over2$~inch intervals.
For instance, in the above example I have used one tab 
at the beginning of each line but the last, which has two.
By putting tabs in before the colons
in the signature part of the schema, I can get
the types to line up in columns:
\ftlmargin=0.0in \ftrmargin=0.0in
È‚BirthdayBook1·
	names	: Ü∞ ã NAME
	dates	: Ü∞ ã DATE
	hwm	: Ü
…
	Éi,j: 1 .. hwm é
		i à j  ä  names(i) à names(j)
 
It may require some experiment to get the right
number of tabs.
You can change the tabstop interval by setting
the dimension register \verb"\tabstop" to the
interval you want. E.g., with
\begin{verbatim}
\tabstop=1.0in
\end{verbatim}
our example looks like:
\tabstop=1.0in
È‚BirthdayBook1·
	names	: Ü∞ãNAME
	dates	: Ü∞ãDATE
	hwm	: Ü
…
	Éi,j: 1 .. hwm é
		i à j  ä  names(i) à names(j)
 


\pagebreak
\section{Index of Defined Terms}
\ftlmargin=1in \ftrmargin=1in
\printindex
\end{document}

