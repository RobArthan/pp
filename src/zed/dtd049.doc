=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{FST PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Detailed Design for Z Paragraphs}  %% Mandatory field
\TPPref{DS/FMU/IED/DTD049}  %% Mandatory field
\def\SCCSversion{$Revision$
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$
}}  %% Mandatory field (with sensible default)
\TPPstatus{Draft}
%\TPPstatus{Approved}
\TPPtype{Specification}
\TPPkeywords{HOL}
\TPPauthor{D.J.~King & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthorisation{R.D.~Arthan & FST Team Leader}
\TPPabstract{This document contains the detailed design of the
	interface used to input Z specifications into the Z Proof Support System.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
      Library \\ R.D. Arthan\\ D.J. King}}

%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\pagebreak
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}

\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History}  % to get section number `0.3'

\begin{description}
\item[Issue 1.1] First draft based on the HOL lexis and
using the HOL lexical analyser \cite{DS/FMU/IED/DTD015}. Stubs for the Z term
respresentation and the Z term/schematext parsers are
provided.

\end{description}
\subsection{Changes Forecast}

When a Z lexical analyser and a Z lexis is available
\cite{DS/FMU/IED/DTD060}, the
implementation will be modified to use that. Also, the
Z term representation which is used by the parser for
parsed terms will be modified to be brought into line
when the representation has been agreed and made available
in the Z term/schematext parser design \cite{DS/FMU/IED/DTD061}.

\pagebreak
\section{GENERAL}

\subsection{Scope}
The design in this document covers Z paragraphs which comprise
part of the user interface for the Z proof support system
described in \cite{DS/FMU/IED/HLD018}. The development is
carried out according to \cite{DS/FMU/IED/PLN007}.

\subsection{Introduction}

\subsubsection{Background and Purpose}

A handler is required to recognise Z paragraphs and parse
them to produce terms for type checking, and ultimately for
use in proof development.

\subsubsection{Interface}
The signature for Z paragraphs is provided in \ref{SIGNATURE}.

\subsubsection{Deficiencies}
None Known.
\subsubsection{Dependencies}

The signature for Z paragraphs depends on the Z term parser and
schema text parser \cite{DS/FMU/IED/DTD061}. The type of input
is defined in \cite{DS/FMU/IED/DTD015}. The implementation depends
also on the Z lexical analyser \cite{DS/FMU/IED/DTD060}.

\section{PROLOGUE}
The following Standard ML code defines the
data structure which the parser produces upon successful
acceptance of a syntactic Z construct. It will be removed
when the Z term parser is available and defined in the
appropriate place.

=SML
structure ParserStub = struct
datatype ZOPCLASS   = ZPreOp | ZInOp | ZPostOp | ZNormal;
type DECOR = string;
type IDENT = string;
datatype ZTM	= Ztvar of IDENT * ZTM list
			| Ztcon of IDENT * ZTM list
			| Ztseq of ZTM list
			| Ztbag of ZTM list
			| Ztsetd of ZTM list
			| Ztseta1 of ZSCHTEXT
			| Ztseta2 of ZSCHTEXT * ZTM
			| Ztpower of ZTM
			| Zttuple of ZTM list
			| Ztprod of ZTM list
			| Zttheta of ZTM * DECOR
			| Ztsel of ZTM * IDENT
			| Ztapp of ZTM * ZTM
			| Ztlam of ZSCHTEXT * ZTM
			| Ztmu1 of ZSCHTEXT
			| Ztmu2 of ZSCHTEXT * ZTM
			| Ztschema of ZSCHTEXT
			| Ztdec of ZTM * DECOR
			| Ztpre of ZTM
			| Ztneg of ZTM
			| Ztand of ZTM * ZTM
			| Ztor of ZTM * ZTM
			| Ztimp of ZTM * ZTM
			| Ztiff of ZTM * ZTM
			| Ztpro of ZTM * ZTM
			| Zthide of ZTM * IDENT list
			| Ztexi of ZSCHTEXT * ZTM
			| Ztunexi of ZSCHTEXT * ZTM
			| Ztuni of ZSCHTEXT * ZTM
			| Ztdel of ZTM
			| Ztxi of ZTM
			| Ztcomp of ZTM * ZTM
			| Ztconstrained of ZTM * ZTM
			| Zttrue
			| Ztfalse
			| Zteq of ZTM * ZTM
			| Ztmem of ZTM * ZTM
and ZDEC		= ZdDec of ZOPCLASS * IDENT * ZTM
			| ZdDecsexp of ZTM * DECOR
withtype ZSCHTEXT	= ZDEC list * ZTM;
=TEX
The following stubs functions are provided as stubs for
the implementation.
=SML
val token_stream : Lex.HOL_TOKEN list ref = ref [];
fun parse_z_term htl : ZTM = Zttrue;
fun pparse_z_term htl : ZTM = Zttrue;
fun parse_z_schtext htl : ZSCHTEXT = ([], Zttrue);
fun parse_deflhs lhs = ("", ZNormal, []);
end (* structure ParserStub *);
open ParserStub;
=TEX

\section{VARIETIES OF Z PARAGRAPH}

The types of Z paragraph which this document covers are
those specified in the concrete syntax \cite{DS/FMU/IED/DEF007}. These
are basic type declarations (given sets), axiomatic descriptions,
constraints, schema definitions, abbreviations, schema references, generic
constants and free type definitions. The syntax of each of these is covered
in sections \ref{IDENTS} to \ref{FT}.

\subsection{Identifiers}\label{IDENTS}
An Identifier is defined in \cite{Spivey89} as a word with an optional
decoration,
=GFT BNF Syntax
Ident		=	Word | Word, Decor;
=TEX
where a word is a sequence of characters, and a decoration is
a sequence of strokes.
=GFT BNF Syntax
Word		=	`Char` | Word, `Char`;
Decor		=	`Stroke` | Decor, `Stroke`;
=TEX
Identifiers in Z are separated by commas.
=GFT BNF Syntax
Idents		=	Ident | Ident, `,` , Idents;
=TEX
\subsection{Z General Text}
=GFT BNF Syntax
ZOther		=	`¹Z`, ZFrags, `°`;
ZFragSeq	=	ZFrag | ZFragSeq, `;`, ZFrag
=TEX
=GFT BNF Syntax
ZFrag		=	GivenSets
		|	Constraint
		|	Abbreviation
		|	HorizSchema
		|	FreeType;
=TEX
\subsection{Basic Type Declarations}
A basic type declaration takes the form of a list
of type identifiers called given types. The concrete syntax of a
basic type declaration is
=GFT BNF Syntax
GivenSets	=	`[`, Idents, `]`;
=TEX
An example of a given set is
¹IZ
[MESSAGE, STATE]
°
\subsection{Axiomatic Descriptions}
=GFT BNF Syntax
AxiomaticBox	=	`¹ZAX`, ZSchemaText, `°`
=TEX
¹IZAX
c : ðú
÷
c   {0..5}
°
\subsection{Constraints}
=GFT BNF Syntax
ZTerm		=	`[`, Constraint, `]`;
=TEX
¹IZ
x > 5
°

\subsection{Schema Definitions}
=GFT BNF Syntax
SchemaBox	=	StartZSchema, Ident, Idents, ZTerm, EndBox;
=TEX
{\large
\begin{tabular}{|l|l|}\hline
StartZSchema&\StartZSchema\\\hline
StartZGeneric&\StartZGeneric\\\hline
EndZBox&\EndZBox\\\hline
StartZTerm&\StartZTerm\\\hline
\end{tabular}
}

¹ÿ MYSCHEMA[STATE,MSG]üüüüüüü
s : STATE
t : ð STATE
÷üüüüüüüüüüüü
s  t
ˆüüüüüüüüüüüüü

\subsection{Abbreviation Definitions}
=GFT BNF Syntax
Abbreviation	=	DefLhs, `==`, ZTerm;
=TEX
¹IZ
FRED == abbreviation
°

\subsection{Schema References}
=GFT BNF Syntax
Horiz_Schema	=	DefLhs, `¦`, ZTerm;
=TEX
¹IZ
FRED ¦ abbreviation
°


\subsection{Generic Constants}
=GFT BNF Syntax
GenericBox	=	GenBox, `[`, Idents, `]`, ZSchemaText, EndBox;
=TEX
¹ [X] œœœœœ
s : X
t : ð X
÷üüüüüüü
s  t
ˆüüüüüüü

\subsection{Free Types}\label{FT}
=GFT BNF Syntax
FreeType	=	Ident, `::=`, FreeTypeRhs;
FreeTypeRhs	=	FreeTypeBranch
		|	FreeTypeBranch, `|`, FreeTypeRhs;
FreeTypeBranch	=	Ident
		|	Ident, `§§`, ZTerm, `¢¢`;
Idents		=	Ident | Ident, `,` , Idents;
=TEX
¹IZ
FreeType :== Cons §§a¢¢ | Nil 
°

\section{THE SIGNATURE FOR Z PARAGRAPHS} \label{SIGNATURE}

=DOC
signature ÛZParagraphsÝ = sig
local
	open Lex;
in
=DESCRIBE
=ENDDOC
=DOC
datatype ÛZPARAGRAPHÝ	= ZPAbbDef of IDENT * ZOPCLASS * (IDENT list) * ZTM
			| ZPAxDes of IDENT list * ZSCHTEXT
			| ZPGivens of (IDENT list)
			| ZPConstraint of (IDENT list * ZTM)
			| ZPFreeType of IDENT * (IDENT * (ZTM OPT)) list
=DESCRIBE
=FAILURE
49010	Given set should be in the form [A, B, ...]
49020	Failed to parse an abbreviation
49030	Failed to parse a horizontal schema definition
49040	Failed to parse a free type definition
49060	Syntactic construct is alienitic
49070	Formal Generics should be of the form [A, B, ...]
=ENDDOC
=DOC
val Ûz_axbox_recogniserÝ : string * string * INPUT list * string -> ZPARAGRAPH
=DESCRIBE
=ENDDOC
=DOC
val Ûz_genbox_recogniserÝ : string * string * INPUT list * string -> ZPARAGRAPH
=DESCRIBE
=ENDDOC
=DOC
val Ûz_schbox_recogniserÝ : string * string * INPUT list * string -> ZPARAGRAPH
=DESCRIBE
=ENDDOC
=DOC
val Ûz_term_recogniserÝ : string * string * INPUT list * string -> HOL_TOKEN list
=DESCRIBE
=ENDDOC
=DOC
val Ûz_other_recogniserÝ : string * string * INPUT list * string -> ZPARAGRAPH
=DESCRIBE
=ENDDOC
=SML
end
end; (* of signature ZParagraphs *)
=TEX

\section{TEST POLICY}
The tests should follow the standards and guidelines
laid down in \cite{DS/FMU/IED/PLN008}.

\twocolumn[\section{INDEX OF DEFINED TERMS}]
\printindex
\end{document}



