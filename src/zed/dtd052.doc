% %Z% $Date$ $Revision$ $RCSfile$
=TEX
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\makeindex
\TPPproject{FST PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Detailed Design of Z Primitive Constants in the Theory ``Z''}  %% Mandatory field
\def\TPPheadtitle{Detailed Design of Z Primitive Constants \cr in the Theory ``Z''}
\TPPref{DS/FMU/IED/DTD052}  %% Mandatory field
\def\SCCSversion{$Revision$ %
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$ %
}}
\TPPstatus{Draft}			%% Mandatory field
\TPPtype{SML Literate Script}
\TPPkeywords{}
\TPPauthor{G.M.Prout&WIN01}  %% Mandatory field
%\TPPauthors{G.T.Scullard&WIN01\\G.M.Prout&WIN01 }
\TPPauthorisation{R.B.Jones & Project Manager}
\TPPabstract{This document contains the detailed design of the Z primitive constants in the theory ``Z'' of the Z Proof Support Subsystem.}
\TPPdistribution{\parbox[t]{4.0in}{%
	    Library
}}
\begin{document}
\makeTPPfrontpage
\vfill
\begin{centering}
\bf Copyright \copyright\ : International Computers Ltd \number\year
\end{centering}
\pagebreak
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History} 
\begin{description}
\item [Issue 1.1] 
First draft version.
\item [Issue 1.2] 
Constant names altered to comply with \cite{DS/FMU/IED/DTD047}.
\item [Issue 1.3]
More alterations to names. Theorems removed from signature.
\item [Issue 1.4] (\TPPdate{\FormatDate{$Date$
}})
Projection functions for tuple types included; definition of $U$ changed.
\item [Issue 1.5]
Changed to new fonts
\item [Issue 1.11 (30th June 1992)]
Changed parent of theory $z\_language$.
\item [Issue 1.13, 8 July 1992 ]
Declare language associations for constants.
\item [Issue 1.18,1.19, 27th July 1992 ]
Corrected definition of $Ê$.
\end{description}
%\subsection{Changes Forecast}
\section{GENERAL}
\subsection{Scope}
This document contains the detailed design for the 
Z primitive constants in the theory ``Z'' of
the Z Proof Support System (see \cite{DS/FMU/IED/HLD015}).
This is called for in \cite{DS/FMU/IED/HLD017}.
The design is
implemented in \cite{DS/FMU/IED/IMP052}.
\subsection{Introduction}
\subsubsection{Purpose and Background}
In the Z Proof Support Subsystem, two types of constants have been identified:
\begin{enumerate}
\item
 Constants defined as primitive  in the system.
\item 
Constants that belong to infinite families and thus cannot be defined as primitive, see \cite{DS/FMU/IED/DTD050}. 
\end{enumerate}
This document gives the detailed design for the theory ``z\_language'' which contains the constants of type (1). 
\subsubsection{Dependencies}
The functions in this document are dependent on the Release 1 ICL HOL System and the theory design tools of \cite{DS/FMU/IED/DTD035}.
\subsubsection{Notation}
All constants that are used in the Z semantic mapping described in \cite{DS/FMU/IED/HLD015} are preceded by $Z'$. These constants should not be used by the user of the Z proof support system {\bf unless} the user is prepared to drop out of Z into HOL.


\section{THE THEORY ``z\_language''}

\subsection{Design of the Theory ``z\_language''}

=THDOC
req_name "z_language" (Value "cache'zed");
=DESCRIBE
The theory z\_language defines the primitive constants of the Z Proof Support System.
=ENDDOC

Next, we declare the new theory.
It is a child of the cache theory $cache'zed$ which is created in
the build makefile itself (from \cite{DS/FMU/IED/IMP021}).
=SML
val _ = open_theory "cache'zed";
val _ = delete_theory"z_language" handle Fail _ => ();
val _ = (	set_flag ("ignore_warnings", true);
		delete_type "Z'T[1]" handle Fail _ => ();
		set_flag ("ignore_warnings", false)
	);
val _ = new_theory "z_language";
val _ = set_current_language "Z";
val _ = push_pc "hol";
=TEX

Certain constants are overloaded, they are used in both HOL and Z.

=SML
map (fn s => (declare_const_language(s, "Z"); Nil) handle _ => Value s)
	[	"T", "F",
		"=", "", "´",
		"³", "±", "²"
	];
=TEX

\subsubsection{First of the family of Tuple Types}

The types Z'T[1] and Z'T[2] are tuple types. Their definitions are generated by $labelled\_product\_spec$, 
described in \cite{DS/FMU/IED/DTD059}, and stored under $Z'T[1]$ and $Z'T[2]$ respectively. The constants
 Z'Mk\_T[1] and Z'Mk\_T[2] are the corresponding tuple constructors. The tuple projection Z'T[1]1 
 for the one tuple is also required. These three constants are also  generated by $labelled\_product\_spec$. 
The defining theorem for both Z'Mk\_T[1] and Z'T[1]1 
is stored under the keys $Z'Mk\_T[1]$ and  $Z'T[1]1$. 
The defining theorem for Z'Mk\_T[2] (and the projections 
Z'T[2]1 and Z'T[2]2 ,although they are not needed here)
 is stored under the key $Z'Mk\_T[2]$ (and also the keys
 $Z'T[2]1$ and $Z'T[2]1$).
These types and their associated constants are required by some of the constants defined below.
 is the same as $$ in ICL HOL.

=SML

val _ = open_theory(current_cache_theory());
val _ = labelled_product_spec
	{tykey = "Z'T[1]",
	tyname = "Z'T[1]",
	labels = [("Z'T[1]1",¬:'1®)],
	tyvars = Nil,
	constkeys = ["Z'Mk_T[1]","Z'T[1]1"],
	conname = "Z'Mk_T[1]"};
=TEX

=SML
val _ = labelled_product_spec
	{tykey = "Z'T[2]",
	tyname = "Z'T[2]",
	labels = [("Z'T[2]1",¬:'1®),("Z'T[2]2",¬:'2®)],
	tyvars = Nil,
	constkeys = ["Z'Mk_T[2]","Z'T[2]1","Z'T[2]2"],
	conname = "Z'Mk_T[2]"};
val _ = open_theory"z_language";
=TEX

\subsubsection{The Set of All Things}

The constant z'Totality is the set of all members of a type. It is used by the type inference system and 
its definition is stored under the key $z'Totality$. 

¹HOLCONST
Ü	Ûz'Totalityİ :'a SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	z'Totality = Universe
°

z'U represents the universal type; its definition is stored under the key $U$. 

¹HOLCONST
Ü	Ûz'Uİ : ('a)$"Z'T[1]" ­ 'a
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	z'U = $"Z'T[1]1"
°

Note that lowercase z is used, since the global variables $Totality$ and
$U$ are required to be in the Z name space.


\subsubsection{Z declarations}

Z'SchemaDec has the same meaning as the constant , except it is not declared as infix. It is required 
for the invisible membership assertions which occur when a schema designator is used as a declaration. Its definition is stored under the key $Z'SchemaDec$.

¹HOLCONST
Ü	ÛZ'SchemaDecİ : 'a ­ 'a SET ­ BOOL
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	Z'SchemaDec = $
°

Z'Dec takes a list of variables and a set of the same type as the variables in the list and returns a simple declaration. Its definition is stored under the key $Z'Dec$.

¹HOLCONST
Ü	ÛZ'Decİ : ('a LIST ¸ 'a SET) ­ BOOL
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ vs ·
Ü	Z'Dec ([], vs)
Ü	± 
Ü	(µ v vl · Z'Dec ((Cons v vl), vs)
Ü			¤ v  vs ± Z'Dec (vl, vs))
°

Z'Decl takes a declaration list and returns a term of type $BOOL$, the conjuntion of the declarations in 
the list. Its definition is stored under the key $Z'Decl$.

¹HOLCONST
Ü	ÛZ'Declİ : BOOL LIST ­ BOOL
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	Z'Decl Nil
Ü	±
Ü	µ b bl ·
Ü		Z'Decl (Cons b bl) = (b ± (Z'Decl bl))
°


\subsubsection{Quantification}

¹HOLCONST
Ü	Û$"Z'µ"İ : BOOL ­ BOOL
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Üµ p ·
Ü	$"Z'µ" p = p
°

¹HOLCONST
	Û$"Z'µBody"İ	: BOOL ­  BOOL ­  BOOL ­  BOOL
÷
µ d p v ·
	$"Z'µBody" d p v ¤ (d ± p) ´ v 
°

¹HOLCONST
	Û$"Z'¶"İ	:	BOOL ­ BOOL
÷
µ p ·
	$"Z'¶" p = p
°

¹HOLCONST
	Û$"Z'¶Body"İ	: BOOL ­  BOOL ­  BOOL ­  BOOL
÷
µ d p v ·
	$"Z'¶Body" d p v ¤ d ± p ± v 
°


\subsubsection{Sets and Sequences}

The constants Z'ğ and Z'Setd are the power set and set constructors. 
Their definitions are stored under the keys $Z'ğ$ and $Z'Setd$. 

=SML
val _ = new_type("Ûúİ", 0);
val _ = new_const("ÛZ'Intİ",¬:î ­ ú®);
=TEX

¹HOLCONST
Ü	Û$"Z'ğ"İ :'a SET ­ ('a SET) SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	$"Z'ğ" = ğ
°

¹HOLCONST
Ü	ÛZ'Setdİ :'a LIST ­ 'a SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	Z'Setd Nil = {}
Ü	±
Ü	µ h t · Z'Setd (Cons h t) = (Z'Setd t) À {h}
°

Z'NumList is an auxiliary constant used in the definition of Z'§¢, the sequence constructor. 
$Z'NumList$ is stored under the key $Z'NumList$, and $Z'§¢$ under the key $Z'§¢$.

¹HOLCONST
Ü	ÛZ'NumListİ : ('a LIST ¸ î) ­ (((ú, 'a)$"Z'T[2]") SET)
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ n : î ·
Ü	Z'NumList ([], n) = {}
Ü	±
Ü	(µ a list · Z'NumList  ((Cons a list), n) = 
Ü		(Z'NumList (list, n + 1)) À
Ü			{$"Z'Mk_T[2]" (Z'Int (n + 1)) a})
°

¹HOLCONST
Ü	Û$"Z'§¢"İ : 'a LIST ­ ((ú, 'a)$"Z'T[2]") SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ l ·
Ü	$"Z'§¢" l =  Z'NumList (l, 0)
°

\subsubsection{Definite Description and Application}

Z'Í is the definite description constant. Its definition is stored under the key $Z'Í$. 

¹HOLCONST
	Û$"Z'Í"İ : 'a SET ­ 'a
÷
	µ x : 'a · $"Z'Í" {x} = x
°

=IGN
Ü	Û$"Z'Í"İ : ('a ­ BOOL) ­ 'a
üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ f t ·
Ü	((f = (Ì x · x = t)) ´ ($"Z'Í" f = t))
=TEX

Z'App forms an application of one Z term to another. Its definition is stored under the key $Z'App$.
¹HOLCONST
Ü	ÛZ'Appİ : (('a,'b)$"Z'T[2]") SET ­ 'a ­ 'b
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ f (x : 'a) ·
Ü	Z'App f x = 
Ü		$"Z'Í" {y : 'b | ($"Z'Mk_T[2]" x y)  f}
°

The constant Z'Ê has the same meaning as a $CombK$, the deletion combinator in ICL HOL. Its definition is stored under the key $Z'Ê$. 

¹HOLCONST
Ü	Û$"Z'Ê"İ : 'a ­ 'b ­ 'a
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ x y ·
Ü	$"Z'Ê" x y = x
°

Z'SchemaPred has the same meaning as the constant , except it is not declared as infix. It is required 
for the invisible membership assertions which occur when a schema designator is used as a predicate. 
Its definition is stored under the key $Z'SchemaPred$. 

¹HOLCONST
Ü	ÛZ'SchemaPredİ : 'a ­ 'a SET ­ BOOL
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	Z'SchemaPred = $
°


The constant $Z'³‰s$ is schema negation. Its definition is stored under the key $Z'³‰s$.

¹HOLCONST
Ü	Û$"Z'³‰s"İ : 'a SET ­ 'a SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	µ x s ·
Ü	x  $"Z'³‰s" s ¤ ³(x  s)
°

\subsection{Support for the Z type, CHAR}

The Z type $CHAR$ is equated the the set of all HOL characters.
It is intentional that $CHAR$ be in the name space of the Z user, in order
to support the user of string quotations which type-check to sequences of
$CHAR$.

¹HOLCONST
Ü	Û$"z'CHAR"İ : CHAR SET 
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	z'CHAR = Universe
°

The constructor for strings is $Z'String$ which is defined
to be a mapping from a list of characters to a Z sequence.
The definition is the same as for Z sequences.

¹HOLCONST
Ü	Û$"Z'String"İ : CHAR LIST ­ ((ú, CHAR)$"Z'T[2]") SET
÷üüüüüüüüüüüüüüüüüüüüüüüüüüüüüüü
Ü	$"Z'String" = $"Z'§¢"
°

\subsection{Constants for Z Paragraph Constructs}

Each mapped Z paragraph is wrapped with an identity function so that information
about the form a paragraph was entered into the theory database is not lost.

\subsubsection{Abbreviation Definitions}

¹HOLCONST
	ÛZ'AbbDefİ : BOOL ­ BOOL
÷
µ p ·
	Z'AbbDef p = p
°

\subsubsection{Schema Boxes}

¹HOLCONST
	ÛZ'SchBoxİ : BOOL ­ BOOL
÷
µ p ·
	Z'SchBox p = p
°

\subsubsection{Axiomatic Descriptions}

¹HOLCONST
	ÛZ'AxDesİ : BOOL ­ BOOL
÷
µ p ·
	Z'AxDes p = p
°

\subsubsection{Given Sets}

¹HOLCONST
	ÛZ'GivenSetİ : BOOL ­ BOOL
÷
µ p ·
	Z'GivenSet p = p
°

\subsubsection{Free Type Definitions}

¹HOLCONST
	ÛZ'FreeTypeDefİ : BOOL ­ BOOL
÷
µ p ·
	Z'FreeTypeDef p = p
°

\subsubsection{Constraints}

¹HOLCONST
	ÛZ'Constraintİ : BOOL ­ BOOL
÷
µ p ·
	Z'Constraint p = p
°


\subsection{Fixity Definition for Equality and Membership}

The operators $=$ and $$ must be declared as infix relations for the
parser and the type checker to correctly parse and type check Z terms
and expressions which contain $=$ and $$.

=SML
local
	open ZUserInterfaceSupport;
	val tmpl = map template_of_string ["_ = _", "_  _"];
in
val _ = set_zfixity_info(ZClRel, tmpl)
end;
=TEX

\subsection{End of the Design of the Theory ``ZLanguage''}

\subsection{Signature of the theory ``ZLanguage''}
=DOC
signature ÛZLanguageİ = sig
   val Ûz'totality_defİ : THM
   val Ûz'u_defİ : THM
   val Ûz'decsexp_defİ : THM
   val Ûz'dec_defİ : THM
   val Ûz'decl_defİ : THM
   val Ûz'µ_defİ : THM
   val Ûz'µbody_defİ : THM
   val Ûz'¶_defİ : THM
   val Ûz'¶body_defİ : THM
   val Ûz'ğ_defİ : THM
   val Ûz'setd_defİ : THM
   val Ûz'numlist_defİ : THM
   val Ûz'§¢_defİ : THM
   val Ûz'Í_defİ : THM
   val Ûz'app_defİ : THM
   val Ûz'Ê_defİ : THM
   val Ûz'predsexp_defİ : THM
   val Ûz'³‰s_defİ : THM
   val Ûz'char_defİ : THM
   val Ûz'string_defİ : THM
   val Ûz'abbdef_defİ : THM
   val Ûz'schbox_defİ : THM
   val Ûz'axdes_defİ : THM
   val Ûz'givenset_defİ : THM
   val Ûz'freetypedef_defİ : THM
   val Ûz'constraint_defİ : THM
end (* end of signature ZLanguage *);
=ENDDOC
\section{TEST POLICY}
Any functions given in this document should be tested according to the
general criteria set out in \cite{DS/FMU/IED/PLN008}, using the
tests in \cite{DS/FMU/IED/MDT052}.
In \cite{DS/FMU/IED/MDT052} the theory produced is checked by the theory design tools
of \cite{DS/FMU/IED/DTD035}, against the theory design provided.
\newpage
\twocolumn[\section{INDEX}]
\small
\printindex
\end{document}


