%  dtd088.doc  %Z% $Date$ $Revision$ $RCSfile$
=TEX
% TQtemplate.tex
\documentstyle[hol1,11pt,TQ]{article}
\ftlinepenalty=9999
\def\Hide#1{}
\def\Bool{``$\it{:}bool\,$''}
\makeindex
\TPPproject{FST PROJECT}  %% Mandatory field
%\TPPvolume{}
%\TPPpart{}
\TPPtitle{Detailed Design of the Z Library Bags}  %% Mandatory field
\TPPref{DS/FMU/IED/DTD088}  %% Mandatory field
\def\SCCSversion{$Revision$%
}
\TPPissue{\SCCSversion}  %% Mandatory field
\TPPdate{\FormatDate{$Date$%
}}
%\TPPstatus{Approved}
\TPPstatus{Draft}
\TPPtype{Specification}
\TPPkeywords{HOL}
%\TPPauthor{D.J.~King & WIN01}  %% Mandatory field
%\TPPauthors{Name 1&location 1\\Name 2&location 2\\Name 3&location 3}
\TPPauthors{D.J.~King & WIN01\\K.~Blackburn & WIN01}
\TPPauthorisation{R.D.~Arthan & FST Team Leader}
\TPPabstract{This document contains the detailed design of
the Z Library Bags and their proof support.}
%\TPPabstractB{}
%\TPPabstractC{}
%\TPPabstractD{}
%\TPPabstractE{}
%\TPPabstractF{}
\TPPdistribution{\parbox[t]{4.0in}{%
      Library}}

%\TPPclass{CLASSIFICATION}
%\def\TPPheadlhs{}
%\def\TPPheadcentre{}
%def\TPPheadrhs{}
%\def\TPPfootlhs{}
%\def\TPPfootcentre{}
%\def\TPPfootrhs{}

\begin{document}
\TPPsetsizes
\makeTPPfrontpage

\vfill
\begin{centering}

\bf Copyright \copyright\ : International Computers Ltd \number\year

\end{centering}

\newpage
\section{DOCUMENT CONTROL}
\subsection{Contents List}
\tableofcontents
\subsection{Document Cross References}
\bibliographystyle{fmu}
\bibliography{fmu}

\subsection{Changes History}  % to get section number `0.3'
\begin{description}
\item [Issue 1.1 (22nd October 1992)]
First version, derived from 078 and 083.
\item [Issue 1.2 (30th October 1992)]
Tidying.
\item [Issue 1.3, 12th November 1992] 
Changes as a consequence of changes in dependences.
\item [Issue 1.4, 15th November 1992] 
Added definition of the bag brackets.
\item[Issue 1.5 (11th December 1992)]
Global rename from wrk038.doc issue 1.9.
\end{description}
\subsection{Changes Forecast}
None.
\pagebreak
\section{GENERAL}
\subsection{Scope}
This document contains the detailed design
of the Bags Material of the Z Library.
The high level design for this material is given in \cite{DS/FMU/IED/HLD017}.
\subsection{Introduction}

\subsection{Purpose and Background}
See \cite{DS/FMU/IED/HLD017}.
\subsection{Dependencies}

\subsection{Possible Enhancements}
2nd Edition Spivey changes the name of bag membership, and
gives new operators for bag scaling, bag subsets, and bag difference.
This may need to be tracked as the Z Standard, to date, does not have these changes.
\subsection{Deficiencies}
None known.
\section{PROLOG}

=SML
open_theory"z_sequences";
push_pc "z_sets_alg";
delete_theory"z_bags" handle Fail _ => ();
val icl'was_tco_flag = get_flag "z_type_check_only";
val icl'was_ax_flag = get_flag "z_use_axioms";
set_flag ("z_type_check_only", false);
set_flag ("z_use_axioms", true);
new_theory"z_bags";
=TEX
\section {DEFINITION OF FIXITY}

The following fixity information has been taken from \cite{Spivey89}.
¹Z
fun 3 _ ‚ _
°
¹Z
rel _ in _
°
¹Z
gen 7 bag _
°
In the language of Spivey, bag display is a language construct; the \ProductZ{} language allows (and requires) us to define the bag display here:

¹Z
	fun	û ... ı
°

\section{BAGS}

\subsection{Bags, Multiplicity and Membership}

¹Z
Ûbagİ X ¦ X ß î‰1
°

[X]œœœœœœœœœœœœœœœœ
Ü Ûcountİ : bag X  (X ­ î)
÷üüüüüüüüüüüüüüüüüü
Üµ x : X; B : bag X ·
Ü	count B = (Ìx:X · 0) « B
ˆüüüüüüüüüüüüüüüüüüüü

[X]œœœœœœœœœœœœœœœœ
Ü _ Ûinİ _ : X ª bag X
÷üüüüüüüüüüüüüüüüüü
Ü µ x : X;B : bag X ·
Ü	x in B ¤ x  dom B
ˆüüüüüüüüüüüüüüüüüüüü
N.B. this is as in the 1st edition of Spivey, and in the standard version 0.5,
but its name changes to a ``squared'' $$ in 2nd edition Spivey.

\subsection{Bag Union}
[X]œœœœœœœœœœœœœœœœ
Ü _ Û‚İ _ : (bag X) ¸ bag X ­ bag X
÷üüüüüüüüüüüüüüüüüü
Ü µ B, C : bag X; x : X ·
Ü	count (B ‚ C) x = count B x + count C x
ˆüüüüüüüüüüüüüüüüüüüü

\subsection{Bag of Elements of a Sequence}

[X]œœœœœœœœœœœœœœœœ
Ü Ûitemsİ : seq X ­ bag X
÷üüüüüüüüüüüüüüüüüü
Ü µ s : seq X; x : X ·
Ü	count (items s) x = # {i : dom s | s (i) = x}
ˆüüüüüüüüüüüüüüüüüüüü
\subsection{Bag Display}
[X]œœœœœœœœœœœœœœœœ
	û ... ı : seq X ­ bag X
÷üüüüüüüüü
	û ı = {};
	µx : X; s : seq X· (û ... ı) (§x¢ ë s) = (û ... ı) s « {x í (û ... ı) s x + 1}
ˆüüüüüüüüüüüüüüüüüüü
\section{START OF STRUCTURE}
=DOC
signature ÛZBagsİ = sig
=DESCRIBE
This provides the basic proof support for the Z library bags.
It creates the theory $z\_bags$.
=ENDDOC
=THDOC
req_name Û"z_bags"İ (Value "z_sequences");
req_language "Z";
set_flag("tc_thms_only",true);
=DESCRIBE
The theory $z\_bags$ contains various definitions of relation operators, and ``defining theorems'' of Z library constants derived from these definitions.
It is created in structure $ZBags$.
=ENDDOC

=DOC
val Ûz_bag_defİ : THM;	val Ûz_count_defİ : THM;
val Ûz_in_defİ : THM;	val Ûz_‚_defİ : THM;
val Ûz_items_defİ : THM;
=DESCRIBE
These are the definitions of the Z bag theory.
=ENDDOC

\section{EPILOGUE}
=SML
end (* end of Signature ZBags *);
=TEX
=SML
set_flag ("z_type_check_only", icl'was_tco_flag);
set_flag ("z_use_axioms", icl'was_ax_flag);
=TEX

=TEX
\section{TEST POLICY}
The module tests for this module are to follow the guidelines
laid down in the quality plan~\cite{DS/FMU/IED/PLN008}.

\twocolumn[\section{INDEX}]
\small
\printindex

\end{document}


=IGN
delete_const ¬$"z'_ À _"®;

 [X]œœœœœœœœœœœœœœœœ
 Ü _ ÛÀİ _ : ğ X ¸ ğ X ­ ğ X
 ÷üüüüüüüüüüüüüüüüüü
 Üµ x  : ğ X · x À x = X
 ˆüüüüüüüüüüüüüüüüüüüü

dest_Zapp ñ x À x ®;
dest_app ñ x À x ®;

